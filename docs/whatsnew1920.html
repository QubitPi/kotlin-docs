<!DOCTYPE html SYSTEM "about:legacy-compat">
<html lang="en-US" data-preset="contrast" data-primary-color="#307FFF"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="UTF-8"><meta name="built-on" content="2025-07-01T03:18:32.521605836"><link rel="canonical" href="https://kotlinlang.org/docs/whatsnew1920.html" data-react-helmet="true"><script>
    (function (w, d, s, l, i) {
        w[l] = w[l] || [];
        w[l].push({'gtm.start': new Date().getTime(), event: 'gtm.js'});
        var f = d.getElementsByTagName(s)[0], j = d.createElement(s), dl = l != 'dataLayer' ? '&amp;l=' + l : '';
        j.async = true;
        j.src = '//www.googletagmanager.com/gtm.js?id=' + i + dl;
        f.parentNode.insertBefore(j, f);
    })(window, document, 'script', 'dataLayer', 'GTM-5P98');
</script>
<script src="https://resources.jetbrains.com/storage/help-app/v6/analytics.js"></script>
<title>What's new in Kotlin 1.9.20 | Kotlin Documentation</title><script type="application/json" id="virtual-toc-data">[{"id":"ide-support","level":0,"title":"IDE support","anchor":"#ide-support"},{"id":"new-kotlin-k2-compiler-updates","level":0,"title":"New Kotlin K2 compiler updates","anchor":"#new-kotlin-k2-compiler-updates"},{"id":"support-for-kotlin-wasm","level":1,"title":"Support for Kotlin/Wasm","anchor":"#support-for-kotlin-wasm"},{"id":"preview-kapt-compiler-plugin-with-k2","level":1,"title":"Preview kapt compiler plugin with K2","anchor":"#preview-kapt-compiler-plugin-with-k2"},{"id":"how-to-enable-the-kotlin-k2-compiler","level":1,"title":"How to enable the Kotlin K2 compiler","anchor":"#how-to-enable-the-kotlin-k2-compiler"},{"id":"leave-your-feedback-on-the-new-k2-compiler","level":1,"title":"Leave your feedback on the new K2 compiler","anchor":"#leave-your-feedback-on-the-new-k2-compiler"},{"id":"kotlin-jvm","level":0,"title":"Kotlin/JVM","anchor":"#kotlin-jvm"},{"id":"kotlin-native","level":0,"title":"Kotlin/Native","anchor":"#kotlin-native"},{"id":"custom-memory-allocator-enabled-by-default","level":1,"title":"Custom memory allocator enabled by default","anchor":"#custom-memory-allocator-enabled-by-default"},{"id":"performance-improvements-for-the-garbage-collector","level":1,"title":"Performance improvements for the garbage collector","anchor":"#performance-improvements-for-the-garbage-collector"},{"id":"incremental-compilation-of-klib-artifacts","level":1,"title":"Incremental compilation of klib artifacts","anchor":"#incremental-compilation-of-klib-artifacts"},{"id":"managing-library-linkage-issues","level":1,"title":"Managing library linkage issues","anchor":"#managing-library-linkage-issues"},{"id":"companion-object-initialization-on-class-constructor-calls","level":1,"title":"Companion object initialization on class constructor calls","anchor":"#companion-object-initialization-on-class-constructor-calls"},{"id":"opt-in-requirement-for-all-cinterop-declarations","level":1,"title":"Opt-in requirement for all cinterop declarations","anchor":"#opt-in-requirement-for-all-cinterop-declarations"},{"id":"custom-message-for-linker-errors","level":1,"title":"Custom message for linker errors","anchor":"#custom-message-for-linker-errors"},{"id":"removal-of-the-legacy-memory-manager","level":1,"title":"Removal of the legacy memory manager","anchor":"#removal-of-the-legacy-memory-manager"},{"id":"change-to-our-target-tiers-policy","level":1,"title":"Change to our target tiers policy","anchor":"#change-to-our-target-tiers-policy"},{"id":"kotlin-multiplatform","level":0,"title":"Kotlin Multiplatform","anchor":"#kotlin-multiplatform"},{"id":"kotlin-multiplatform-is-stable","level":1,"title":"Kotlin Multiplatform is Stable","anchor":"#kotlin-multiplatform-is-stable"},{"id":"template-for-configuring-multiplatform-projects","level":1,"title":"Template for configuring multiplatform projects","anchor":"#template-for-configuring-multiplatform-projects"},{"id":"new-project-wizard","level":1,"title":"New project wizard","anchor":"#new-project-wizard"},{"id":"full-support-for-the-gradle-configuration-cache-in-kotlin-multiplatform","level":1,"title":"Full support for the Gradle configuration cache in Kotlin Multiplatform","anchor":"#full-support-for-the-gradle-configuration-cache-in-kotlin-multiplatform"},{"id":"easier-configuration-of-new-standard-library-versions-in-gradle","level":1,"title":"Easier configuration of new standard library versions in Gradle","anchor":"#easier-configuration-of-new-standard-library-versions-in-gradle"},{"id":"default-support-for-third-party-cinterop-libraries","level":1,"title":"Default support for third-party cinterop libraries","anchor":"#default-support-for-third-party-cinterop-libraries"},{"id":"support-for-kotlin-native-compilation-caches-in-compose-multiplatform-projects","level":1,"title":"Support for Kotlin/Native compilation caches in Compose Multiplatform projects","anchor":"#support-for-kotlin-native-compilation-caches-in-compose-multiplatform-projects"},{"id":"compatibility-guidelines","level":1,"title":"Compatibility guidelines","anchor":"#compatibility-guidelines"},{"id":"kotlin-wasm","level":0,"title":"Kotlin/Wasm","anchor":"#kotlin-wasm"},{"id":"compatibility-with-wasm-gc-phase-4-and-final-opcodes","level":1,"title":"Compatibility with Wasm GC phase 4 and final opcodes","anchor":"#compatibility-with-wasm-gc-phase-4-and-final-opcodes"},{"id":"new-wasm-wasi-target-and-the-renaming-of-the-wasm-target-to-wasm-js","level":1,"title":"New wasm-wasi target, and the renaming of the wasm target to wasm-js","anchor":"#new-wasm-wasi-target-and-the-renaming-of-the-wasm-target-to-wasm-js"},{"id":"support-for-the-wasi-api-in-the-standard-library","level":1,"title":"Support for the WASI API in the standard library","anchor":"#support-for-the-wasi-api-in-the-standard-library"},{"id":"kotlin-wasm-api-improvements","level":1,"title":"Kotlin/Wasm API improvements","anchor":"#kotlin-wasm-api-improvements"},{"id":"gradle","level":0,"title":"Gradle","anchor":"#gradle"},{"id":"support-for-test-fixtures-to-access-internal-declarations","level":1,"title":"Support for test fixtures to access internal declarations","anchor":"#support-for-test-fixtures-to-access-internal-declarations"},{"id":"new-property-to-configure-paths-to-konan-directories","level":1,"title":"New property to configure paths to Konan directories","anchor":"#new-property-to-configure-paths-to-konan-directories"},{"id":"new-build-report-metrics-for-kotlin-native-tasks","level":1,"title":"New build report metrics for Kotlin/Native tasks","anchor":"#new-build-report-metrics-for-kotlin-native-tasks"},{"id":"standard-library","level":0,"title":"Standard library","anchor":"#standard-library"},{"id":"replacement-of-the-enum-class-values-generic-function","level":1,"title":"Replacement of the Enum class values generic function","anchor":"#replacement-of-the-enum-class-values-generic-function"},{"id":"the-kotlin-native-standard-library-becomes-stable","level":1,"title":"The Kotlin/Native standard library becomes Stable","anchor":"#the-kotlin-native-standard-library-becomes-stable"},{"id":"improved-performance-of-hashmap-operations-in-kotlin-js","level":1,"title":"Improved performance of HashMap operations in Kotlin/JS","anchor":"#improved-performance-of-hashmap-operations-in-kotlin-js"},{"id":"documentation-updates","level":0,"title":"Documentation updates","anchor":"#documentation-updates"},{"id":"install-kotlin-1-9-20","level":0,"title":"Install Kotlin 1.9.20","anchor":"#install-kotlin-1-9-20"},{"id":"check-the-ide-version","level":1,"title":"Check the IDE version","anchor":"#check-the-ide-version"},{"id":"configure-gradle-settings","level":1,"title":"Configure Gradle settings","anchor":"#configure-gradle-settings"}]</script><script type="application/json" id="topic-shortcuts"></script><link href="https://resources.jetbrains.com/writerside/apidoc/6.22.0-b776/app.css" rel="stylesheet"><link rel="icon" type="image/svg" sizes="16x16" href="https://kotlinlang.org/assets/images/favicon.svg?v2"><link rel="icon" type="image/x-icon" sizes="32x32" href="https://kotlinlang.org/assets/images/favicon.ico?v2"><link rel="icon" type="image/png" sizes="96x96" href="https://kotlinlang.org/assets/images/apple-touch-icon.png?v2"><link rel="icon" type="image/png" sizes="300x300" href="https://kotlinlang.org/assets/images/apple-touch-icon-72x72.png?v2"><link rel="icon" type="image/png" sizes="500x500" href="https://kotlinlang.org/assets/images/apple-touch-icon-114x114.png?v2"><meta name="image" content="https://kotlinlang.org/assets/images/open-graph/docs.png"><!-- Open Graph --><meta property="og:title" content="What's new in Kotlin 1.9.20 | Kotlin"><meta property="og:description" content=""><meta property="og:image" content="https://kotlinlang.org/assets/images/open-graph/docs.png"><meta property="og:site_name" content="Kotlin Help"><meta property="og:type" content="website"><meta property="og:locale" content="en_US"><meta property="og:url" content="https://kotlinlang.org/docs/whatsnew1920.html"><!-- End Open Graph --><!-- Twitter Card --><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content="@kotlin"><meta name="twitter:title" content="What's new in Kotlin 1.9.20 | Kotlin"><meta name="twitter:description" content=""><meta name="twitter:creator" content="@kotlin"><meta name="twitter:image:src" content="https://kotlinlang.org/assets/images/open-graph/docs.png"><!-- End Twitter Card --><!-- Schema.org WebPage --><script type="application/ld+json">{
    "@context": "http://schema.org",
    "@type": "WebPage",
    "@id": "https://kotlinlang.org/docs/whatsnew1920.html#webpage",
    "url": "https://kotlinlang.org/docs/whatsnew1920.html",
    "name": "What's new in Kotlin 1.9.20 | Kotlin",
    "description": "",
    "image": "https://kotlinlang.org/assets/images/open-graph/docs.png",
    "inLanguage":"en-US"
}</script><!-- End Schema.org --><!-- Schema.org WebSite --><script type="application/ld+json">{
    "@type": "WebSite",
    "@id": "https://kotlinlang.org/docs/#website",
    "url": "https://kotlinlang.org/docs/",
    "name": "Kotlin Help"
}</script><!-- End Schema.org --><style>a[href="test-page.html"] { visibility: hidden; }</style></head><body data-id="whatsnew1920" data-main-title="What's new in Kotlin 1.9.20" data-article-props="{&quot;seeAlsoStyle&quot;:&quot;links&quot;}" data-template="article" data-breadcrumbs="What's new in Kotlin///Earlier versions" data-edit-url="https://github.com/JetBrains/kotlin-web-site/edit/master/docs/topics/whatsnew/whatsnew1920.md"><div class="wrapper"><main class="panel _main"><header class="panel__header"><div class="container"><h3>Kotlin  Help</h3><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="whatsnew1920" id="whatsnew1920.md">What's new in Kotlin 1.9.20</h1><p id="-erzqlj_2"><span class="emphasis" id="-erzqlj_17"><a href="releases.html#release-details" id="-erzqlj_18">Released: November 1, 2023</a></span></p><p id="-erzqlj_3">The Kotlin 1.9.20 release is out, the <a href="#new-kotlin-k2-compiler-updates" id="-erzqlj_19">K2 compiler for all the targets is now in Beta</a>, and <a href="#kotlin-multiplatform-is-stable" id="-erzqlj_20">Kotlin Multiplatform is now Stable</a>. Additionally, here are some of the main highlights:</p><ul class="list _bullet" id="-erzqlj_4"><li class="list__item" id="-erzqlj_21"><p id="-erzqlj_27"><a href="#template-for-configuring-multiplatform-projects" id="-erzqlj_28">New default hierarchy template for setting up multiplatform projects</a></p></li><li class="list__item" id="-erzqlj_22"><p id="-erzqlj_29"><a href="#full-support-for-the-gradle-configuration-cache-in-kotlin-multiplatform" id="-erzqlj_30">Full support for the Gradle configuration cache in Kotlin Multiplatform</a></p></li><li class="list__item" id="-erzqlj_23"><p id="-erzqlj_31"><a href="#custom-memory-allocator-enabled-by-default" id="-erzqlj_32">Custom memory allocator enabled by default in Kotlin/Native</a></p></li><li class="list__item" id="-erzqlj_24"><p id="-erzqlj_33"><a href="#performance-improvements-for-the-garbage-collector" id="-erzqlj_34">Performance improvements for the garbage collector in Kotlin/Native</a></p></li><li class="list__item" id="-erzqlj_25"><p id="-erzqlj_35"><a href="#new-wasm-wasi-target-and-the-renaming-of-the-wasm-target-to-wasm-js" id="-erzqlj_36">New and renamed targets in Kotlin/Wasm</a></p></li><li class="list__item" id="-erzqlj_26"><p id="-erzqlj_37"><a href="#support-for-the-wasi-api-in-the-standard-library" id="-erzqlj_38">Support for the WASI API in the standard library for Kotlin/Wasm</a></p></li></ul><p id="-erzqlj_5">You can also find a short overview of the updates in this video:</p><div class="video-player" id="-erzqlj_6"><object class="article__bordered-element" width="560" height="315" data-theme="light" type="application/x-shockwave-flash" data="https://www.youtube.com/v/Ol_96CHKqg8?color2=FBE9EC&amp;rel=0&amp;hd=1&amp;autoplay=0&amp;version=3&amp;modestbranding=1&amp;fs=1"></object></div><section class="chapter"><h2 id="ide-support" data-toc="ide-support">IDE support</h2><p id="-erzqlj_39">The Kotlin plugins that support 1.9.20 are available for:</p><div class="table-wrapper"><table class="wide" id="-erzqlj_40"><thead><tr class="ijRowHead" id="-erzqlj_42"><th id="-erzqlj_45"><p>IDE</p></th><th id="-erzqlj_46"><p>Supported versions</p></th></tr></thead><tbody><tr id="-erzqlj_43"><td id="-erzqlj_47"><p>IntelliJ IDEA</p></td><td id="-erzqlj_48"><p>2023.1.x, 2023.2.x, 2023.x</p></td></tr><tr id="-erzqlj_44"><td id="-erzqlj_49"><p>Android Studio</p></td><td id="-erzqlj_50"><p>Hedgehog (2023.1.1), Iguana (2023.2.1)</p></td></tr></tbody></table></div><aside class="prompt" data-type="note" data-title="" id="-erzqlj_41"><p id="-erzqlj_51">Starting from IntelliJ IDEA 2023.3.x and Android Studio Iguana (2023.2.1) Canary 15, the Kotlin plugin is automatically included and updated. All you need to do is update the Kotlin version in your projects.</p></aside></section><section class="chapter"><h2 id="new-kotlin-k2-compiler-updates" data-toc="new-kotlin-k2-compiler-updates">New Kotlin K2 compiler updates</h2><p id="-erzqlj_52">The Kotlin team at JetBrains is continuing to stabilize the new K2 compiler, which will bring major performance improvements, speed up new language feature development, unify all the platforms that Kotlin supports, and provide a better architecture for multiplatform projects.</p><p id="-erzqlj_53">K2 is currently in <span class="control" id="-erzqlj_58">Beta</span> for all targets. <a href="https://blog.jetbrains.com/kotlin/2023/11/kotlin-1-9-20-released/" id="-erzqlj_59" data-external="true" rel="noopener noreferrer" target="_blank">Read more in the release blog post</a></p><section class="chapter"><h3 id="support-for-kotlin-wasm" data-toc="support-for-kotlin-wasm">Support for Kotlin/Wasm</h3><p id="-erzqlj_60">Since this release, the Kotlin/Wasm supports the new K2 compiler. <a href="#how-to-enable-the-kotlin-k2-compiler" id="-erzqlj_61">Learn how to enable it in your project</a>.</p></section><section class="chapter"><h3 id="preview-kapt-compiler-plugin-with-k2" data-toc="preview-kapt-compiler-plugin-with-k2">Preview kapt compiler plugin with K2</h3><aside class="prompt" data-type="warning" data-title="" id="-erzqlj_62"><p id="-erzqlj_68">Support for K2 in the kapt compiler plugin is <a href="components-stability.html" id="-erzqlj_69">Experimental</a>. Opt-in is required (see details below), and you should use it only for evaluation purposes.</p></aside><p id="-erzqlj_63">In 1.9.20, you can try using the <a href="kapt.html" id="-erzqlj_70">kapt compiler plugin</a> with the K2 compiler. To use the K2 compiler in your project, add the following options to your <code class="code" id="-erzqlj_71">gradle.properties</code> file:</p><div class="code-block" data-lang="none">
kotlin.experimental.tryK2=true
kapt.use.k2=true
</div><p id="-erzqlj_65">Alternatively, you can enable K2 for kapt by completing the following steps:</p><ol class="list _decimal" id="-erzqlj_66" type="1"><li class="list__item" id="-erzqlj_72"><p id="-erzqlj_74">In your <code class="code" id="-erzqlj_75">build.gradle.kts</code> file, <a href="gradle-compiler-options.html#example-of-setting-languageversion" id="-erzqlj_76">set the language version</a> to <code class="code" id="-erzqlj_77">2.0</code>.</p></li><li class="list__item" id="-erzqlj_73"><p id="-erzqlj_78">In your <code class="code" id="-erzqlj_79">gradle.properties</code> file, add <code class="code" id="-erzqlj_80">kapt.use.k2=true</code>.</p></li></ol><p id="-erzqlj_67">If you encounter any issues when using kapt with the K2 compiler, please report them to our <a href="http://kotl.in/issue" id="-erzqlj_81" data-external="true" rel="noopener noreferrer" target="_blank">issue tracker</a>.</p></section><section class="chapter"><h3 id="how-to-enable-the-kotlin-k2-compiler" data-toc="how-to-enable-the-kotlin-k2-compiler">How to enable the Kotlin K2 compiler</h3><section class="chapter"><h4 id="enable-k2-in-gradle" data-toc="enable-k2-in-gradle">Enable K2 in Gradle</h4><p id="-erzqlj_85">To enable and test the Kotlin K2 compiler, use the new language version with the following compiler option:</p><div class="code-block" data-lang="bash">
-language-version 2.0
</div><p id="-erzqlj_87">You can specify it in your <code class="code" id="-erzqlj_89">build.gradle.kts</code> file:</p><div class="code-block" data-lang="kotlin">
kotlin {
    sourceSets.all {
        languageSettings {
            languageVersion = &quot;2.0&quot;
        }
    }
}
</div></section><section class="chapter"><h4 id="enable-k2-in-maven" data-toc="enable-k2-in-maven">Enable K2 in Maven</h4><p id="-erzqlj_90">To enable and test the Kotlin K2 compiler, update the <code class="code" id="-erzqlj_92">&lt;project/&gt;</code> section of your <code class="code" id="-erzqlj_93">pom.xml</code> file:</p><div class="code-block" data-lang="markup">
&lt;properties&gt;
    &lt;kotlin.compiler.languageVersion&gt;2.0&lt;/kotlin.compiler.languageVersion&gt;
&lt;/properties&gt;
</div></section><section class="chapter"><h4 id="enable-k2-in-intellij-idea" data-toc="enable-k2-in-intellij-idea">Enable K2 in IntelliJ IDEA</h4><p id="-erzqlj_94">To enable and test the Kotlin K2 compiler in IntelliJ IDEA, go to <span class="control" id="-erzqlj_95">Settings</span> | <span class="control" id="-erzqlj_96">Build, Execution, Deployment</span> | <span class="control" id="-erzqlj_97">Compiler</span> | <span class="control" id="-erzqlj_98">Kotlin Compiler</span> and update the <span class="control" id="-erzqlj_99">Language Version</span> field to <code class="code" id="-erzqlj_100">2.0 (experimental)</code>.</p></section></section><section class="chapter"><h3 id="leave-your-feedback-on-the-new-k2-compiler" data-toc="leave-your-feedback-on-the-new-k2-compiler">Leave your feedback on the new K2 compiler</h3><p id="-erzqlj_101">We would appreciate any feedback you may have!</p><ul class="list _bullet" id="-erzqlj_102"><li class="list__item" id="-erzqlj_103"><p id="-erzqlj_106">Provide your feedback directly to K2 developers on Kotlin Slack &ndash; <a href="https://surveys.jetbrains.com/s3/kotlin-slack-sign-up?_gl=1*ju6cbn*_ga*MTA3MTk5NDkzMC4xNjQ2MDY3MDU4*_ga_9J976DJZ68*MTY1ODMzNzA3OS4xMDAuMS4xNjU4MzQwODEwLjYw" id="-erzqlj_107" data-external="true" rel="noopener noreferrer" target="_blank">get an invite</a> and join the <a href="https://kotlinlang.slack.com/archives/C03PK0PE257" id="-erzqlj_108" data-external="true" rel="noopener noreferrer" target="_blank">#k2-early-adopters</a> channel.</p></li><li class="list__item" id="-erzqlj_104"><p id="-erzqlj_109">Report any problems you faced with the new K2 compiler on <a href="https://kotl.in/issue" id="-erzqlj_110" data-external="true" rel="noopener noreferrer" target="_blank">our issue tracker</a>.</p></li><li class="list__item" id="-erzqlj_105"><p id="-erzqlj_111"><a href="https://www.jetbrains.com/help/idea/settings-usage-statistics.html" id="-erzqlj_112" data-external="true" rel="noopener noreferrer" target="_blank">Enable the Send usage statistics option</a> to allow JetBrains to collect anonymous data about K2 usage.</p></li></ul></section></section><section class="chapter"><h2 id="kotlin-jvm" data-toc="kotlin-jvm">Kotlin/JVM</h2><p id="-erzqlj_113">Starting with version 1.9.20, the compiler can generate classes containing Java 21 bytecode.</p></section><section class="chapter"><h2 id="kotlin-native" data-toc="kotlin-native">Kotlin/Native</h2><p id="-erzqlj_114">Kotlin 1.9.20 includes a Stable memory manager with the new memory allocator enabled by default, performance improvements for the garbage collector, and other updates:</p><ul class="list _bullet" id="-erzqlj_115"><li class="list__item" id="-erzqlj_125"><p id="-erzqlj_134"><a href="#custom-memory-allocator-enabled-by-default" id="-erzqlj_135">Custom memory allocator enabled by default</a></p></li><li class="list__item" id="-erzqlj_126"><p id="-erzqlj_136"><a href="#performance-improvements-for-the-garbage-collector" id="-erzqlj_137">Performance improvements for the garbage collector</a></p></li><li class="list__item" id="-erzqlj_127"><p id="-erzqlj_138"><a href="#incremental-compilation-of-klib-artifacts" id="-erzqlj_139">Incremental compilation of <code class="code" id="-erzqlj_140">klib</code> artifacts</a></p></li><li class="list__item" id="-erzqlj_128"><p id="-erzqlj_141"><a href="#managing-library-linkage-issues" id="-erzqlj_142">Managing library linkage issues</a></p></li><li class="list__item" id="-erzqlj_129"><p id="-erzqlj_143"><a href="#companion-object-initialization-on-class-constructor-calls" id="-erzqlj_144">Companion object initialization on class constructor calls</a></p></li><li class="list__item" id="-erzqlj_130"><p id="-erzqlj_145"><a href="#opt-in-requirement-for-all-cinterop-declarations" id="-erzqlj_146">Opt-in requirement for all cinterop declarations</a></p></li><li class="list__item" id="-erzqlj_131"><p id="-erzqlj_147"><a href="#custom-message-for-linker-errors" id="-erzqlj_148">Custom message for linker errors</a></p></li><li class="list__item" id="-erzqlj_132"><p id="-erzqlj_149"><a href="#removal-of-the-legacy-memory-manager" id="-erzqlj_150">Removal of the legacy memory manager</a></p></li><li class="list__item" id="-erzqlj_133"><p id="-erzqlj_151"><a href="#change-to-our-target-tiers-policy" id="-erzqlj_152">Change to our target tiers policy</a></p></li></ul><section class="chapter"><h3 id="custom-memory-allocator-enabled-by-default" data-toc="custom-memory-allocator-enabled-by-default">Custom memory allocator enabled by default</h3><p id="-erzqlj_153">Kotlin 1.9.20 comes with the new memory allocator enabled by default. It's designed to replace the previous default allocator, <code class="code" id="-erzqlj_158">mimalloc</code>, to make garbage collection more efficient and improve the runtime performance of the <a href="native-memory-manager.html" id="-erzqlj_159">Kotlin/Native memory manager</a>.</p><p id="-erzqlj_154">The new custom allocator divides system memory into pages, allowing independent sweeping in consecutive order. Each allocation becomes a memory block within a page, and the page keeps track of block sizes. Different page types are optimized for various allocation sizes. The consecutive arrangement of memory blocks ensures efficient iteration through all allocated blocks.</p><p id="-erzqlj_155">When a thread allocates memory, it searches for a suitable page based on the allocation size. Threads maintain a set of pages for different size categories. Typically, the current page for a given size can accommodate the allocation. If not, the thread requests a different page from the shared allocation space. This page may already be available, require sweeping, or have to be created first.</p><p id="-erzqlj_156">The new allocator allows for multiple independent allocation spaces simultaneously, which will enable the Kotlin team to experiment with different page layouts to improve performance even further.</p><section class="chapter"><h4 id="how-to-enable-the-custom-memory-allocator" data-toc="how-to-enable-the-custom-memory-allocator">How to enable the custom memory allocator</h4><p id="-erzqlj_160">Starting with Kotlin 1.9.20, the new memory allocator is the default. No additional setup is required.</p><p id="-erzqlj_161">If you experience high memory consumption, you can switch back to <code class="code" id="-erzqlj_163">mimalloc</code> or the system allocator with <code class="code" id="-erzqlj_164">-Xallocator=mimalloc</code> or <code class="code" id="-erzqlj_165">-Xallocator=std</code> in your Gradle build script. Please report such issues in <a href="https://kotl.in/issue" id="-erzqlj_166" data-external="true" rel="noopener noreferrer" target="_blank">YouTrack</a> to help us improve the new memory allocator.</p><p id="-erzqlj_162">For the technical details of the new allocator's design, see this <a href="https://github.com/JetBrains/kotlin/blob/master/kotlin-native/runtime/src/alloc/custom/README.md" id="-erzqlj_167" data-external="true" rel="noopener noreferrer" target="_blank">README</a>.</p></section></section><section class="chapter"><h3 id="performance-improvements-for-the-garbage-collector" data-toc="performance-improvements-for-the-garbage-collector">Performance improvements for the garbage collector</h3><p id="-erzqlj_168">The Kotlin team continues to improve the performance and stability of the new Kotlin/Native memory manager. This release brings a number of significant changes to the garbage collector (GC), including the following 1.9.20 highlights:</p><ul class="list _bullet" id="-erzqlj_169"><li class="list__item" id="-erzqlj_172"><p id="-erzqlj_174"><a href="#full-parallel-mark-to-reduce-the-pause-time-for-the-gc" id="-erzqlj_175">Full parallel mark to reduce the pause time for the GC</a></p></li><li class="list__item" id="-erzqlj_173"><p id="-erzqlj_176"><a href="#tracking-memory-in-big-chunks-to-improve-the-allocation-performance" id="-erzqlj_177">Tracking memory in big chunks to improve the allocation performance</a></p></li></ul><section class="chapter"><h4 id="full-parallel-mark-to-reduce-the-pause-time-for-the-gc" data-toc="full-parallel-mark-to-reduce-the-pause-time-for-the-gc">Full parallel mark to reduce the pause time for the GC</h4><p id="-erzqlj_178">Previously, the default garbage collector performed only a partial parallel mark. When the mutator thread was paused, it would mark the GC's start from its own roots, like thread&ndash;local variables and the call stack. Meanwhile, a separate GC thread was responsible for marking the start from global roots, as well as the roots of all mutators that were actively running the native code and therefore not paused.</p><p id="-erzqlj_179">This approach worked well in cases where there were a limited number of global objects and the mutator threads spent a considerable amount of time in a runnable state executing Kotlin code. However, this is not the case for typical iOS applications.</p><p id="-erzqlj_180">Now the GC uses a full parallel mark that combines paused mutators, the GC thread, and optional marker threads to process the mark queue. By default, the marking process is performed by:</p><ul class="list _bullet" id="-erzqlj_181"><li class="list__item" id="-erzqlj_183"><p id="-erzqlj_185">Paused mutators. Instead of processing their own roots and then being idle while not actively executing code, they contribute to the whole marking process.</p></li><li class="list__item" id="-erzqlj_184"><p id="-erzqlj_186">The GC thread. This ensures that at least one thread will perform marking.</p></li></ul><p id="-erzqlj_182">This new approach makes the marking process more efficient, reducing the pause time of the GC.</p></section><section class="chapter"><h4 id="tracking-memory-in-big-chunks-to-improve-the-allocation-performance" data-toc="tracking-memory-in-big-chunks-to-improve-the-allocation-performance">Tracking memory in big chunks to improve the allocation performance</h4><p id="-erzqlj_187">Previously, the GC scheduler tracked the allocation of each object individually. However, neither the new default custom allocator nor the <code class="code" id="-erzqlj_189">mimalloc</code> memory allocator allocates separate storage for each object; they allocate large areas for several objects at once.</p><p id="-erzqlj_188">In Kotlin 1.9.20, the GC tracks areas instead of individual objects. This speeds up the allocation of small objects by reducing the number of tasks performed on each allocation and, therefore, helps to minimize the garbage collector's memory usage.</p></section></section><section class="chapter"><h3 id="incremental-compilation-of-klib-artifacts" data-toc="incremental-compilation-of-klib-artifacts">Incremental compilation of klib artifacts</h3><aside class="prompt" data-type="warning" data-title="" id="-erzqlj_190"><p id="-erzqlj_199">This feature is <a href="components-stability.html#stability-levels-explained" id="-erzqlj_200">Experimental</a>. It may be dropped or changed at any time. Opt-in is required (see details below). Use it only for evaluation purposes. We would appreciate your feedback on it in <a href="https://kotl.in/issue" id="-erzqlj_201" data-external="true" rel="noopener noreferrer" target="_blank">YouTrack</a>.</p></aside><p id="-erzqlj_191">Kotlin 1.9.20 introduces a new compilation time optimization for Kotlin/Native. The compilation of <code class="code" id="-erzqlj_202">klib</code> artifacts into native code is now partially incremental.</p><p id="-erzqlj_192">When compiling Kotlin source code into native binary in debug mode, the compilation goes through two stages:</p><ol class="list _decimal" id="-erzqlj_193" type="1"><li class="list__item" id="-erzqlj_203"><p id="-erzqlj_205">Source code is compiled into <code class="code" id="-erzqlj_206">klib</code> artifacts.</p></li><li class="list__item" id="-erzqlj_204"><p id="-erzqlj_207"><code class="code" id="-erzqlj_208">klib</code> artifacts, along with dependencies, are compiled into a binary.</p></li></ol><p id="-erzqlj_194">To optimize the compilation time in the second stage, the team has already implemented compiler caches for dependencies. They are compiled into native code only once, and the result is reused every time a binary is compiled. But <code class="code" id="-erzqlj_209">klib</code> artifacts built from project sources were always fully recompiled into native code at every project change.</p><p id="-erzqlj_195">With the new incremental compilation, if the project module change causes only a partial recompilation of source code into <code class="code" id="-erzqlj_210">klib</code> artifacts, just a part of the <code class="code" id="-erzqlj_211">klib</code> is further recompiled into a binary.</p><p id="-erzqlj_196">To enable incremental compilation, add the following option to your <code class="code" id="-erzqlj_212">gradle.properties</code> file:</p><div class="code-block" data-lang="none">
kotlin.incremental.native=true
</div><p id="-erzqlj_198">If you face any issues, report such cases to <a href="https://kotl.in/issue" id="-erzqlj_213" data-external="true" rel="noopener noreferrer" target="_blank">YouTrack</a>.</p></section><section class="chapter"><h3 id="managing-library-linkage-issues" data-toc="managing-library-linkage-issues">Managing library linkage issues</h3><p id="-erzqlj_214">This release improves the way the Kotlin/Native compiler handles linkage issues in Kotlin libraries. Error messages now include more readable declarations as they use signature names instead of hashes, helping you find and fix the issue more easily. Here's an example:</p><div class="code-block" data-lang="none">
No function found for symbol 'org.samples/MyClass.removedFunction|removedFunction(kotlin.Int;kotlin.String){}[0]'
</div><p id="-erzqlj_216">The Kotlin/Native compiler detects linkage issues between third-party Kotlin libraries and reports errors at runtime. You might face such issues if the author of one third-party Kotlin library makes an incompatible change in experimental APIs that another third-party Kotlin library consumes.</p><p id="-erzqlj_217">Starting with Kotlin 1.9.20, the compiler detects linkage issues in silent mode by default. You can adjust this setting in your projects:</p><ul class="list _bullet" id="-erzqlj_218"><li class="list__item" id="-erzqlj_221"><p id="-erzqlj_223">If you want to record these issues in your compilation logs, enable warnings with the <code class="code" id="-erzqlj_224">-Xpartial-linkage-loglevel=WARNING</code> compiler option.</p></li><li class="list__item" id="-erzqlj_222"><p id="-erzqlj_225">It's also possible to raise the severity of reported warnings to compilation errors with <code class="code" id="-erzqlj_226">-Xpartial-linkage-loglevel=ERROR</code>. In this case, the compilation fails, and you get all the errors in the compilation log. Use this option to examine the linkage issues more closely.</p></li></ul><div class="code-block" data-lang="kotlin">
// An example of passing compiler options in a Gradle build file:
kotlin {
    macosX64(&quot;native&quot;) {
        binaries.executable()

        compilations.configureEach {
            compilerOptions.configure {
                // To report linkage issues as warnings:
                freeCompilerArgs.add(&quot;-Xpartial-linkage-loglevel=WARNING&quot;)

                // To raise linkage warnings to errors:
                freeCompilerArgs.add(&quot;-Xpartial-linkage-loglevel=ERROR&quot;)
            }
        }
    }
}
</div><p id="-erzqlj_220">If you face unexpected problems with this feature, you can always opt out with the <code class="code" id="-erzqlj_227">-Xpartial-linkage=disable</code> compiler option. Don't hesitate to report such cases to <a href="https://kotl.in/issue" id="-erzqlj_228" data-external="true" rel="noopener noreferrer" target="_blank">our issue tracker</a>.</p></section><section class="chapter"><h3 id="companion-object-initialization-on-class-constructor-calls" data-toc="companion-object-initialization-on-class-constructor-calls">Companion object initialization on class constructor calls</h3><p id="-erzqlj_229">Starting with Kotlin 1.9.20, the Kotlin/Native backend calls static initializers for companion objects in class constructors:</p><div class="code-block" data-lang="kotlin">
class Greeting {
    companion object {
        init {
            print(&quot;Hello, Kotlin!&quot;) 
        }
    }
}

fun main() {
    val start = Greeting() // Prints &quot;Hello, Kotlin!&quot;
}
</div><p id="-erzqlj_231">The behavior is now unified with Kotlin/JVM, where a companion object is initialized when the corresponding class matching the semantics of a Java static initializer is loaded (resolved).</p><p id="-erzqlj_232">Now that the implementation of this feature is more consistent between platforms, it's easier to share code in Kotlin Multiplatform projects.</p></section><section class="chapter"><h3 id="opt-in-requirement-for-all-cinterop-declarations" data-toc="opt-in-requirement-for-all-cinterop-declarations">Opt-in requirement for all cinterop declarations</h3><p id="-erzqlj_233">Starting with Kotlin 1.9.20, all Kotlin declarations generated by the <code class="code" id="-erzqlj_236">cinterop</code> tool from C and Objective-C libraries, like libcurl and libxml, are marked with <code class="code" id="-erzqlj_237">@ExperimentalForeignApi</code>. If the opt-in annotation is missing, your code won't compile.</p><p id="-erzqlj_234">This requirement reflects the <a href="components-stability.html#stability-levels-explained" id="-erzqlj_238">Experimental</a> status of the import of C and Objective-C libraries. We recommend that you confine its use to specific areas in your projects. This will make your migration easier once we begin stabilizing the import.</p><aside class="prompt" data-type="note" data-title="" id="-erzqlj_235"><p id="-erzqlj_239">As for native platform libraries shipped with Kotlin/Native (like Foundation, UIKit, and POSIX), only some of their APIs need an opt-in with <code class="code" id="-erzqlj_240">@ExperimentalForeignApi</code>. In such cases, you get a warning with an opt-in requirement.</p></aside></section><section class="chapter"><h3 id="custom-message-for-linker-errors" data-toc="custom-message-for-linker-errors">Custom message for linker errors</h3><p id="-erzqlj_241">If you're a library author, you can now help your users resolve linker errors with custom messages.</p><p id="-erzqlj_242">If your Kotlin library depends on C or Objective-C libraries, for example, using the <a href="https://www.jetbrains.com/help/kotlin-multiplatform-dev/multiplatform-cocoapods-overview.html" id="-erzqlj_244" data-external="true" rel="noopener noreferrer" target="_blank">CocoaPods integration</a>, its users need to have these dependent libraries locally on the machine or configure them explicitly in the project build script. If this was not the case, users used to get a confusing &quot;Framework not found&quot; message.</p><p id="-erzqlj_243">You can now provide a specific instruction or a link in the compilation failure message. To do that, pass the <code class="code" id="-erzqlj_245">-Xuser-setup-hint</code> compiler option to <code class="code" id="-erzqlj_246">cinterop</code> or add a <code class="code" id="-erzqlj_247">userSetupHint=message</code> property to your <code class="code" id="-erzqlj_248">.def</code> file.</p></section><section class="chapter"><h3 id="removal-of-the-legacy-memory-manager" data-toc="removal-of-the-legacy-memory-manager">Removal of the legacy memory manager</h3><p id="-erzqlj_249">The <a href="native-memory-manager.html" id="-erzqlj_251">new memory manager</a> was introduced in Kotlin 1.6.20 and became the default in 1.7.20. Since then, it has been receiving further updates and performance improvements and has become Stable.</p><p id="-erzqlj_250">The time has come to complete the deprecation cycle and remove the legacy memory manager. If you're still using it, remove the <code class="code" id="-erzqlj_252">kotlin.native.binary.memoryModel=strict</code> option from your <code class="code" id="-erzqlj_253">gradle.properties</code> and follow our <a href="native-migration-guide.html" id="-erzqlj_254">Migration guide</a> to make the necessary changes.</p></section><section class="chapter"><h3 id="change-to-our-target-tiers-policy" data-toc="change-to-our-target-tiers-policy">Change to our target tiers policy</h3><p id="-erzqlj_255">We've decided to upgrade the requirements for <a href="native-target-support.html#tier-1" id="-erzqlj_260">tier 1 support</a>. The Kotlin team is now committed to providing source and binary compatibility between compiler releases for targets eligible for tier 1. They must also be regularly tested with CI tools to be able to compile and run. Currently, tier 1 includes the following targets for macOS hosts:</p><ul class="list _bullet" id="-erzqlj_256"><li class="list__item" id="-erzqlj_261"><p id="-erzqlj_265"><code class="code" id="-erzqlj_266">macosX64</code></p></li><li class="list__item" id="-erzqlj_262"><p id="-erzqlj_267"><code class="code" id="-erzqlj_268">macosArm64</code></p></li><li class="list__item" id="-erzqlj_263"><p id="-erzqlj_269"><code class="code" id="-erzqlj_270">iosSimulatorArm64</code></p></li><li class="list__item" id="-erzqlj_264"><p id="-erzqlj_271"><code class="code" id="-erzqlj_272">iosX64</code></p></li></ul><p id="-erzqlj_257">In Kotlin 1.9.20, we've also removed a number of previously deprecated targets, namely:</p><ul class="list _bullet" id="-erzqlj_258"><li class="list__item" id="-erzqlj_273"><p id="-erzqlj_279"><code class="code" id="-erzqlj_280">iosArm32</code></p></li><li class="list__item" id="-erzqlj_274"><p id="-erzqlj_281"><code class="code" id="-erzqlj_282">watchosX86</code></p></li><li class="list__item" id="-erzqlj_275"><p id="-erzqlj_283"><code class="code" id="-erzqlj_284">wasm32</code></p></li><li class="list__item" id="-erzqlj_276"><p id="-erzqlj_285"><code class="code" id="-erzqlj_286">mingwX86</code></p></li><li class="list__item" id="-erzqlj_277"><p id="-erzqlj_287"><code class="code" id="-erzqlj_288">linuxMips32</code></p></li><li class="list__item" id="-erzqlj_278"><p id="-erzqlj_289"><code class="code" id="-erzqlj_290">linuxMipsel32</code></p></li></ul><p id="-erzqlj_259">See the full list of currently <a href="native-target-support.html" id="-erzqlj_291">supported targets</a>.</p></section></section><section class="chapter"><h2 id="kotlin-multiplatform" data-toc="kotlin-multiplatform">Kotlin Multiplatform</h2><p id="-erzqlj_292">Kotlin 1.9.20 focuses on the stabilization of Kotlin Multiplatform and makes new steps in improving developer experience with the new project wizards and other notable features:</p><ul class="list _bullet" id="-erzqlj_293"><li class="list__item" id="-erzqlj_302"><p id="-erzqlj_310"><a href="#kotlin-multiplatform-is-stable" id="-erzqlj_311">Kotlin Multiplatform is Stable</a></p></li><li class="list__item" id="-erzqlj_303"><p id="-erzqlj_312"><a href="#template-for-configuring-multiplatform-projects" id="-erzqlj_313">Template for configuring multiplatform projects</a></p></li><li class="list__item" id="-erzqlj_304"><p id="-erzqlj_314"><a href="#new-project-wizard" id="-erzqlj_315">New project wizard</a></p></li><li class="list__item" id="-erzqlj_305"><p id="-erzqlj_316"><a href="#full-support-for-the-gradle-configuration-cache-in-kotlin-multiplatform" id="-erzqlj_317">Full support for the Gradle Configuration cache</a></p></li><li class="list__item" id="-erzqlj_306"><p id="-erzqlj_318"><a href="#easier-configuration-of-new-standard-library-versions-in-gradle" id="-erzqlj_319">Easier configuration of new standard library versions in Gradle</a></p></li><li class="list__item" id="-erzqlj_307"><p id="-erzqlj_320"><a href="#default-support-for-third-party-cinterop-libraries" id="-erzqlj_321">Default support for third-party cinterop libraries</a></p></li><li class="list__item" id="-erzqlj_308"><p id="-erzqlj_322"><a href="#support-for-kotlin-native-compilation-caches-in-compose-multiplatform-projects" id="-erzqlj_323">Support for Kotlin/Native compilation caches in Compose Multiplatform projects</a></p></li><li class="list__item" id="-erzqlj_309"><p id="-erzqlj_324"><a href="#compatibility-guidelines" id="-erzqlj_325">Compatibility guidelines</a></p></li></ul><section class="chapter"><h3 id="kotlin-multiplatform-is-stable" data-toc="kotlin-multiplatform-is-stable">Kotlin Multiplatform is Stable</h3><p id="-erzqlj_326">The 1.9.20 release marks an important milestone in the evolution of Kotlin: <a href="https://www.jetbrains.com/help/kotlin-multiplatform-dev/get-started.html" id="-erzqlj_329" data-external="true" rel="noopener noreferrer" target="_blank">Kotlin Multiplatform</a> has finally become Stable. This means that the technology is safe to use in your projects and 100% ready for production. It also means that further development of Kotlin Multiplatform will continue according to our strict <a href="https://kotlinfoundation.org/language-committee-guidelines/" id="-erzqlj_330" data-external="true" rel="noopener noreferrer" target="_blank">backward compatibility rules</a>.</p><p id="-erzqlj_327">Please note that some advanced features of Kotlin Multiplatform are still evolving. When using them, you'll receive a warning that describes the current stability status of the feature you're using. Before using any experimental functionality in IntelliJ IDEA, <br> you'll need to enable it explicitly in <span class="control" id="-erzqlj_332">Settings</span> | <span class="control" id="-erzqlj_333">Advanced Settings</span> | <span class="control" id="-erzqlj_334">Kotlin</span> | <span class="control" id="-erzqlj_335">Experimental Multiplatform</span>.</p><ul class="list _bullet" id="-erzqlj_328"><li class="list__item" id="-erzqlj_336"><p id="-erzqlj_339">Visit the <a href="https://blog.jetbrains.com/kotlin/2023/11/kotlin-multiplatform-stable/" id="-erzqlj_340" data-external="true" rel="noopener noreferrer" target="_blank">Kotlin blog</a> to learn more about the Kotlin Multiplatform stabilization and future plans.</p></li><li class="list__item" id="-erzqlj_337"><p id="-erzqlj_341">Check out the <a href="https://www.jetbrains.com/help/kotlin-multiplatform-dev/multiplatform-compatibility-guide.html" id="-erzqlj_342" data-external="true" rel="noopener noreferrer" target="_blank">Multiplatform compatibility guide</a> to see what significant changes were made on the way to stabilization.</p></li><li class="list__item" id="-erzqlj_338"><p id="-erzqlj_343">Read about the <a href="https://www.jetbrains.com/help/kotlin-multiplatform-dev/multiplatform-expect-actual.html" id="-erzqlj_344" data-external="true" rel="noopener noreferrer" target="_blank">mechanism of expected and actual declarations</a>, an important part of Kotlin Multiplatform that was also partially stabilized in this release.</p></li></ul></section><section class="chapter"><h3 id="template-for-configuring-multiplatform-projects" data-toc="template-for-configuring-multiplatform-projects">Template for configuring multiplatform projects</h3><p id="-erzqlj_345">Starting with Kotlin 1.9.20, the Kotlin Gradle plugin automatically creates shared source sets for popular multiplatform scenarios. If your project setup is one of them, you don't need to configure the source set hierarchy manually. Just explicitly specify the targets necessary for your project.</p><p id="-erzqlj_346">Setup is now easier thanks to the default hierarchy template, a new feature of the Kotlin Gradle plugin. It's a predefined template of a source set hierarchy built into the plugin. It includes intermediate source sets that Kotlin automatically creates for the targets you declared. <a href="#see-the-full-hierarchy-template" id="-erzqlj_351">See the full template</a>.</p><section class="chapter"><h4 id="create-your-project-easier" data-toc="create-your-project-easier">Create your project easier</h4><p id="-erzqlj_352">Consider a multiplatform project that targets both Android and iPhone devices and is developed on an Apple silicon MacBook. Compare how this project is set up between different versions of Kotlin:</p><div class="table-wrapper"><table class="wide" id="-erzqlj_353"><thead><tr class="ijRowHead" id="-erzqlj_358"><th id="-erzqlj_360"><p>Kotlin 1.9.0 and earlier (a standard setup)</p></th><th id="-erzqlj_361"><p>Kotlin 1.9.20</p></th></tr></thead><tbody><tr id="-erzqlj_359"><td id="-erzqlj_362"><div class="code-block" data-lang="kotlin">
kotlin {
    androidTarget()
    iosArm64()
    iosSimulatorArm64()

    sourceSets {
        val commonMain by getting

        val iosMain by creating {
            dependsOn(commonMain)
        }

        val iosArm64Main by getting {
            dependsOn(iosMain)
        }

        val iosSimulatorArm64Main by getting {
            dependsOn(iosMain)
        }
    }
}
</div></td><td id="-erzqlj_363"><div class="code-block" data-lang="kotlin">
kotlin {
    androidTarget()
    iosArm64()
    iosSimulatorArm64()

    // The iosMain source set is created automatically
}
</div></td></tr></tbody></table></div><p id="-erzqlj_354">Notice how the use of the default hierarchy template considerably reduces the amount of boilerplate code needed to set up your project.</p><p id="-erzqlj_355">When you declare the <code class="code" id="-erzqlj_366">androidTarget</code>, <code class="code" id="-erzqlj_367">iosArm64</code>, and <code class="code" id="-erzqlj_368">iosSimulatorArm64</code> targets in your code, the Kotlin Gradle plugin finds suitable shared source sets from the template and creates them for you. The resulting hierarchy looks like this:</p><figure id="-erzqlj_356"><a href="images/default-hierarchy-example.svg" class="lightbox"><img alt="An example of the default target hierarchy in use" src="images/default-hierarchy-example.svg" title="An example of the default target hierarchy in use" width="350" height="225"></a></figure><p id="-erzqlj_357">Green source sets are actually created and included in the project, while gray ones from the default template are ignored.</p></section><section class="chapter"><h4 id="use-completion-for-source-sets" data-toc="use-completion-for-source-sets">Use completion for source sets</h4><p id="-erzqlj_369">To make it easier to work with the created project structure, IntelliJ IDEA now provides completion for source sets created with the default hierarchy template:</p><figure data-theme="light" id="-erzqlj_370" width="350"><img alt="IDE completion for source set names" src="images/multiplatform-hierarchy-completion.png" class="js-gif article__bordered-element" data-gif-src="images/multiplatform-hierarchy-completion.animated.gif" width="350" style="width: 350px;"></figure><p id="-erzqlj_371">Kotlin also warns you if you attempt to access a source set that doesn't exist because you haven't declared the respective target. In the example below, there is no JVM target (only <code class="code" id="-erzqlj_375">androidTarget</code>, which is not the same). But let's try to use the <code class="code" id="-erzqlj_376">jvmMain</code> source set and see what happens:</p><div class="code-block" data-lang="kotlin">
kotlin {
    androidTarget()
    iosArm64()
    iosSimulatorArm64()

    sourceSets {
        jvmMain {
        }
    }
}
</div><p id="-erzqlj_373">In this case, Kotlin reports a warning in the build log:</p><div class="code-block" data-lang="none">
w: Accessed 'source set jvmMain' without registering the jvm target:
  kotlin {
      jvm() /* &lt;- register the 'jvm' target */

      sourceSets.jvmMain.dependencies {

      }
  }
</div></section><section class="chapter"><h4 id="set-up-the-target-hierarchy" data-toc="set-up-the-target-hierarchy">Set up the target hierarchy</h4><p id="-erzqlj_377">Starting with Kotlin 1.9.20, the default hierarchy template is automatically enabled. In most cases, no additional setup is required.</p><p id="-erzqlj_378">However, if you're migrating existing projects created before 1.9.20, you might encounter a warning if you had previously introduced intermediate sources manually with <code class="code" id="-erzqlj_380">dependsOn()</code> calls. To solve this issue, do the following:</p><ul class="list _bullet" id="-erzqlj_379"><li class="list__item" id="-erzqlj_381"><p id="-erzqlj_384">If your intermediate source sets are currently covered by the default hierarchy template, remove all manual <code class="code" id="-erzqlj_386">dependsOn()</code> calls and source sets created with <code class="code" id="-erzqlj_387">by creating</code> constructions.</p><p id="-erzqlj_385">To check the list of all default source sets, see the <a href="#see-the-full-hierarchy-template" id="-erzqlj_388">full hierarchy template</a>.</p></li><li class="list__item" id="-erzqlj_382"><p id="-erzqlj_389">If you want to have additional source sets that the default hierarchy template doesn't provide, for example, one that shares code between a macOS and a JVM target, adjust the hierarchy by reapplying the template explicitly with <code class="code" id="-erzqlj_391">applyDefaultHierarchyTemplate()</code> and configuring additional source sets manually as usual with <code class="code" id="-erzqlj_392">dependsOn()</code>:</p><div class="code-block" data-lang="kotlin">
kotlin {
    jvm()
    macosArm64()
    iosArm64()
    iosSimulatorArm64()

    // Apply the default hierarchy explicitly. It'll create, for example, the iosMain source set:
    applyDefaultHierarchyTemplate()

    sourceSets {
        // Create an additional jvmAndMacos source set
        val jvmAndMacos by creating {
            dependsOn(commonMain.get())
        }

        macosArm64Main.get().dependsOn(jvmAndMacos)
        jvmMain.get().dependsOn(jvmAndMacos)
    }
}
</div></li><li class="list__item" id="-erzqlj_383"><p id="-erzqlj_393">If there are already source sets in your project that have the exact same names as those generated by the template but that are shared among different sets of targets, there's currently no way to modify the default <code class="code" id="-erzqlj_397">dependsOn</code> relations between the template's source sets.</p><p id="-erzqlj_394">One option you have here is to find different source sets for your purposes, either in the default hierarchy template or ones that have been manually created. Another is to opt out of the template completely.</p><p id="-erzqlj_395">To opt out, add <code class="code" id="-erzqlj_398">kotlin.mpp.applyDefaultHierarchyTemplate=false</code> to your <code class="code" id="-erzqlj_399">gradle.properties</code> and configure all other source sets manually.</p><p id="-erzqlj_396">We're currently working on an API for creating your own hierarchy templates to simplify the setup process in such cases.</p></li></ul></section><section class="chapter"><div class="collapse"><div class="collapse__title"><h4 id="see-the-full-hierarchy-template" data-toc="see-the-full-hierarchy-template">See the full hierarchy template</h4></div><div class="collapse__content"><p id="-erzqlj_400">When you declare the targets to which your project compiles, the plugin picks the shared source sets from the template accordingly and creates them in your project.</p><figure id="-erzqlj_401"><img alt="Default hierarchy template" src="images/full-template-hierarchy.svg" title="Default hierarchy template" width="706" height="757"></figure><aside class="prompt" data-type="tip" data-title="" id="-erzqlj_402"><p id="-erzqlj_403">This example only shows the production part of the project, omitting the <code class="code" id="-erzqlj_404">Main</code> suffix (for example, using <code class="code" id="-erzqlj_405">common</code> instead of <code class="code" id="-erzqlj_406">commonMain</code>). However, everything is the same for <code class="code" id="-erzqlj_407">*Test</code> sources as well.</p></aside></div></div></section></section><section class="chapter"><h3 id="new-project-wizard" data-toc="new-project-wizard">New project wizard</h3><p id="-erzqlj_408">The JetBrains team is introducing a new way of creating cross&ndash;platform projects &ndash; the <a href="https://kmp.jetbrains.com" id="-erzqlj_416" data-external="true" rel="noopener noreferrer" target="_blank">Kotlin Multiplatform web wizard</a>.</p><p id="-erzqlj_409">This first implementation of the new Kotlin Multiplatform wizard covers the most popular Kotlin Multiplatform use cases. It incorporates all the feedback about previous project templates and makes the architecture as robust and reliable as possible.</p><p id="-erzqlj_410">The new wizard has a distributed architecture that allows us to have a unified backend and different frontends, with the web version being the first step. We're considering both implementing an IDE version and creating a command-line tool in the future. On the web, you always get the latest version of the wizard, while in IDEs you'll need to wait for the next release.</p><p id="-erzqlj_411">With the new wizard, project setup is easier than ever. You can tailor your projects to your needs by choosing the target platforms for mobile, server, and desktop development. We also plan to add web development in future releases.</p><figure id="-erzqlj_412"><img alt="Multiplatform web wizard" src="images/multiplatform-web-wizard.png" title="Multiplatform web wizard" width="400" height="647"></figure><p id="-erzqlj_413">The new project wizard is now the preferred way to create cross&ndash;platform projects with Kotlin. Since 1.9.20, the Kotlin plugin no longer provides a <span class="control" id="-erzqlj_417">Kotlin Multiplatform</span> project wizard in IntelliJ IDEA.</p><p id="-erzqlj_414">The new wizard will guide you easily through the initial setup, making the onboarding process much smoother. If you encounter any issues, please report them to <a href="https://kotl.in/issue" id="-erzqlj_418" data-external="true" rel="noopener noreferrer" target="_blank">YouTrack</a> to help us improve your experience with the wizard.</p><p id="-erzqlj_415"><a href="https://kmp.jetbrains.com" id="-erzqlj_419" data-external="true" rel="noopener noreferrer" target="_blank"><figure id="-erzqlj_420"><img alt="Create a project" src="images/multiplatform-create-project-button.png" title="Create a project" width="700" height="50"></figure></a></p></section><section class="chapter"><h3 id="full-support-for-the-gradle-configuration-cache-in-kotlin-multiplatform" data-toc="full-support-for-the-gradle-configuration-cache-in-kotlin-multiplatform">Full support for the Gradle configuration cache in Kotlin Multiplatform</h3><p id="-erzqlj_421">Previously, we introduced a <a href="whatsnew19.html#preview-of-the-gradle-configuration-cache" id="-erzqlj_424">preview</a> of the Gradle configuration cache, which was available for Kotlin multiplatform libraries. With 1.9.20, the Kotlin Multiplatform plugin takes a step further.</p><p id="-erzqlj_422">It now supports the Gradle configuration cache in the <a href="https://www.jetbrains.com/help/kotlin-multiplatform-dev/multiplatform-cocoapods-dsl-reference.html" id="-erzqlj_425" data-external="true" rel="noopener noreferrer" target="_blank">Kotlin CocoaPods Gradle plugin</a>, as well as in the integration tasks that are necessary for Xcode builds, like <code class="code" id="-erzqlj_426">embedAndSignAppleFrameworkForXcode</code>.</p><p id="-erzqlj_423">Now all multiplatform projects can take advantage of the improved build time. The Gradle configuration cache speeds up the build process by reusing the results of the configuration phase for subsequent builds. For more details and setup instructions, see the <a href="https://docs.gradle.org/current/userguide/configuration_cache.html#config_cache:usage" id="-erzqlj_427" data-external="true" rel="noopener noreferrer" target="_blank">Gradle documentation</a>.</p></section><section class="chapter"><h3 id="easier-configuration-of-new-standard-library-versions-in-gradle" data-toc="easier-configuration-of-new-standard-library-versions-in-gradle">Easier configuration of new standard library versions in Gradle</h3><p id="-erzqlj_428">When you create a multiplatform project, a dependency for the standard library (<code class="code" id="-erzqlj_432">stdlib</code>) is added automatically to each source set. This is the easiest way to get started with your multiplatform projects.</p><p id="-erzqlj_429">Previously, if you wanted to configure a dependency on the standard library manually, you needed to configure it for each source set individually. From <code class="code" id="-erzqlj_433">kotlin-stdlib:1.9.20</code> onward, you only need to configure the dependency <span class="control" id="-erzqlj_434">once</span> in the <code class="code" id="-erzqlj_435">commonMain</code> root source set:</p><div class="table-wrapper"><table class="wide" id="-erzqlj_430"><thead><tr class="ijRowHead" id="-erzqlj_436"><th id="-erzqlj_438"><p>Standard library version 1.9.10 and earlier</p></th><th id="-erzqlj_439"><p>Standard library version 1.9.20</p></th></tr></thead><tbody><tr id="-erzqlj_437"><td id="-erzqlj_440"><div class="code-block" data-lang="kotlin">
kotlin {
    sourceSets {
        // For the common source set
        val commonMain by getting {
            dependencies {
                implementation(&quot;org.jetbrains.kotlin:kotlin-stdlib-common:1.9.10&quot;)
            }
        }

        // For the JVM source set
        val jvmMain by getting {
            dependencies {
                implementation(&quot;org.jetbrains.kotlin:kotlin-stdlib:1.9.10&quot;)
            }
        }

        // For the JS source set
        val jsMain by getting {
            dependencies {
                implementation(&quot;org.jetbrains.kotlin:kotlin-stdlib-js:1.9.10&quot;)
            }
        }
    }
}
</div></td><td id="-erzqlj_441"><div class="code-block" data-lang="kotlin">
kotlin {
    sourceSets {
        commonMain {
            dependencies {
                implementation(&quot;org.jetbrains.kotlin:kotlin-stdlib:1.9.20&quot;)
            }
        }
    }
}
</div></td></tr></tbody></table></div><p id="-erzqlj_431">This change was made possible by including new information in the Gradle metadata of the standard library. This allows Gradle to automatically resolve the correct standard library artifacts for the other source sets.</p></section><section class="chapter"><h3 id="default-support-for-third-party-cinterop-libraries" data-toc="default-support-for-third-party-cinterop-libraries">Default support for third-party cinterop libraries</h3><p id="-erzqlj_444">Kotlin 1.9.20 adds default support (rather than support by opt-in) for all cinterop dependencies in projects that have the <a href="https://www.jetbrains.com/help/kotlin-multiplatform-dev/multiplatform-cocoapods-overview.html" id="-erzqlj_447" data-external="true" rel="noopener noreferrer" target="_blank">Kotlin CocoaPods Gradle</a> plugin applied.</p><p id="-erzqlj_445">This means you can now share more native code without being limited by platform&ndash;specific dependencies. For example, you can add <a href="https://www.jetbrains.com/help/kotlin-multiplatform-dev/multiplatform-cocoapods-libraries.html" id="-erzqlj_448" data-external="true" rel="noopener noreferrer" target="_blank">dependencies on Pod libraries</a> to the <code class="code" id="-erzqlj_449">iosMain</code> shared source set.</p><p id="-erzqlj_446">Previously, this only worked with <a href="native-platform-libs.html" id="-erzqlj_450">platform-specific libraries</a> shipped with a Kotlin/Native distribution (like Foundation, UIKit, and POSIX). All third-party Pod libraries are now available in shared source sets by default. You no longer need to specify a separate Gradle property to support them.</p></section><section class="chapter"><h3 id="support-for-kotlin-native-compilation-caches-in-compose-multiplatform-projects" data-toc="support-for-kotlin-native-compilation-caches-in-compose-multiplatform-projects">Support for Kotlin/Native compilation caches in Compose Multiplatform projects</h3><p id="-erzqlj_451">This release resolves a compatibility issue with the Compose Multiplatform compiler plugin, which mostly affected Compose Multiplatform projects for iOS.</p><p id="-erzqlj_452">To work around this issue, you had to disable caching by using the <code class="code" id="-erzqlj_455">kotlin.native.cacheKind=none</code> Gradle property. However, this workaround came at a performance cost: It slowed down compilation time as caching didn't work in the Kotlin/Native compiler.</p><p id="-erzqlj_453">Now that the issue is fixed, you can remove <code class="code" id="-erzqlj_456">kotlin.native.cacheKind=none</code> from your <code class="code" id="-erzqlj_457">gradle.properties</code> file and enjoy the improved compilation times in your Compose Multiplatform projects.</p><p id="-erzqlj_454">For more tips on improving compilation times, see the <a href="native-improving-compilation-time.html" id="-erzqlj_458">Kotlin/Native documentation</a>.</p></section><section class="chapter"><h3 id="compatibility-guidelines" data-toc="compatibility-guidelines">Compatibility guidelines</h3><p id="-erzqlj_459">When configuring your projects, check the Kotlin Multiplatform Gradle plugin's compatibility with the available Gradle, Xcode, and Android Gradle plugin (AGP) versions:</p><div class="table-wrapper"><table class="wide" id="-erzqlj_460"><thead><tr class="ijRowHead" id="-erzqlj_463"><th id="-erzqlj_465"><p>Kotlin Multiplatform Gradle plugin</p></th><th id="-erzqlj_466"><p>Gradle</p></th><th id="-erzqlj_467"><p>Android Gradle plugin</p></th><th id="-erzqlj_468"><p>Xcode</p></th></tr></thead><tbody><tr id="-erzqlj_464"><td id="-erzqlj_469"><p>1.9.20</p></td><td id="-erzqlj_470"><p>7.5 and later</p></td><td id="-erzqlj_471"><p>7.4.2&ndash;8.2</p></td><td id="-erzqlj_472"><p>15.0. See details below</p></td></tr></tbody></table></div><p id="-erzqlj_461">As of this release, the recommended version of Xcode is 15.0. Libraries delivered with Xcode 15.0 are fully supported, and you can access them from anywhere in your Kotlin code.</p><p id="-erzqlj_462">However, XCode 14.3 should still work in the majority of cases. Keep in mind that if you use version 14.3 on your local machine, libraries delivered with Xcode 15 will be visible but not accessible.</p></section></section><section class="chapter"><h2 id="kotlin-wasm" data-toc="kotlin-wasm">Kotlin/Wasm</h2><p id="-erzqlj_473">In 1.9.20, Kotlin Wasm reached the <a href="components-stability.html" id="-erzqlj_480">Alpha level</a> of stability.</p><ul class="list _bullet" id="-erzqlj_474"><li class="list__item" id="-erzqlj_481"><p id="-erzqlj_485"><a href="#compatibility-with-wasm-gc-phase-4-and-final-opcodes" id="-erzqlj_486">Compatibility with Wasm GC phase 4 and final opcodes</a></p></li><li class="list__item" id="-erzqlj_482"><p id="-erzqlj_487"><a href="#new-wasm-wasi-target-and-the-renaming-of-the-wasm-target-to-wasm-js" id="-erzqlj_488">New <code class="code" id="-erzqlj_489">wasm-wasi</code> target, and the renaming of the <code class="code" id="-erzqlj_490">wasm</code> target to <code class="code" id="-erzqlj_491">wasm-js</code></a></p></li><li class="list__item" id="-erzqlj_483"><p id="-erzqlj_492"><a href="#support-for-the-wasi-api-in-the-standard-library" id="-erzqlj_493">Support for the WASI API in standard library</a></p></li><li class="list__item" id="-erzqlj_484"><p id="-erzqlj_494"><a href="#kotlin-wasm-api-improvements" id="-erzqlj_495">Kotlin/Wasm API improvements</a></p></li></ul><aside class="prompt" data-type="note" data-title="" id="-erzqlj_475"><p id="-erzqlj_496">Kotlin Wasm is <a href="components-stability.html" id="-erzqlj_498">Alpha</a>. It is subject to change at any time. Use it only for evaluation purposes.</p><p id="-erzqlj_497">We would appreciate your feedback on it in <a href="https://kotl.in/issue" id="-erzqlj_499" data-external="true" rel="noopener noreferrer" target="_blank">YouTrack</a>.</p></aside><section class="chapter"><h3 id="compatibility-with-wasm-gc-phase-4-and-final-opcodes" data-toc="compatibility-with-wasm-gc-phase-4-and-final-opcodes">Compatibility with Wasm GC phase 4 and final opcodes</h3><p id="-erzqlj_500">Wasm GC moves to the final phase and it requires updates of opcodes &ndash; constant numbers used in the binary representation. Kotlin 1.9.20 supports the latest opcodes, so we strongly recommend that you update your Wasm projects to the latest version of Kotlin. We also recommend using the latest versions of browsers with the Wasm environment:</p><ul class="list _bullet" id="-erzqlj_501"><li class="list__item" id="-erzqlj_502"><p id="-erzqlj_504">Version 119 or newer for Chrome and Chromium&ndash;based browsers.</p></li><li class="list__item" id="-erzqlj_503"><p id="-erzqlj_505">Version 119 or newer for Firefox. Note that in Firefox 119, you need to <a href="wasm-troubleshooting.html" id="-erzqlj_506">turn on Wasm GC manually</a>.</p></li></ul></section><section class="chapter"><h3 id="new-wasm-wasi-target-and-the-renaming-of-the-wasm-target-to-wasm-js" data-toc="new-wasm-wasi-target-and-the-renaming-of-the-wasm-target-to-wasm-js">New wasm-wasi target, and the renaming of the wasm target to wasm-js</h3><p id="-erzqlj_507">In this release, we're introducing a new target for Kotlin/Wasm &ndash; <code class="code" id="-erzqlj_513">wasm-wasi</code>. We're also renaming the <code class="code" id="-erzqlj_514">wasm</code> target to <code class="code" id="-erzqlj_515">wasm-js</code>. In the Gradle DSL, these targets are available as <code class="code" id="-erzqlj_516">wasmWasi {}</code> and <code class="code" id="-erzqlj_517">wasmJs {}</code>, respectively.</p><p id="-erzqlj_508">To use these targets in your project, update the <code class="code" id="-erzqlj_518">build.gradle.kts</code> file:</p><div class="code-block" data-lang="kotlin">
kotlin {
    wasmWasi {
        // ...
    }
    wasmJs {
        // ...
    }
}
</div><p id="-erzqlj_510">The previously introduced <code class="code" id="-erzqlj_519">wasm {}</code> block has been deprecated in favor of <code class="code" id="-erzqlj_520">wasmJs {}</code>.</p><p id="-erzqlj_511">To migrate your existing Kotlin/Wasm project, do the following:</p><ul class="list _bullet" id="-erzqlj_512"><li class="list__item" id="-erzqlj_521"><p id="-erzqlj_523">In the <code class="code" id="-erzqlj_524">build.gradle.kts</code> file, rename the <code class="code" id="-erzqlj_525">wasm {}</code> block to <code class="code" id="-erzqlj_526">wasmJs {}</code>.</p></li><li class="list__item" id="-erzqlj_522"><p id="-erzqlj_527">In your project structure, rename the <code class="code" id="-erzqlj_528">wasmMain</code> directory to <code class="code" id="-erzqlj_529">wasmJsMain</code>.</p></li></ul></section><section class="chapter"><h3 id="support-for-the-wasi-api-in-the-standard-library" data-toc="support-for-the-wasi-api-in-the-standard-library">Support for the WASI API in the standard library</h3><p id="-erzqlj_530">In this release, we have included support for <a href="https://github.com/WebAssembly/WASI" id="-erzqlj_536" data-external="true" rel="noopener noreferrer" target="_blank">WASI</a>, a system interface for the Wasm platform. WASI support makes it easier for you to use Kotlin/Wasm outside of browsers, for example in server&ndash;side applications, by offering a standardized set of APIs for accessing system resources. In addition, WASI provides capability&ndash;based security &ndash; another layer of security when accessing external resources.</p><p id="-erzqlj_531">To run Kotlin/Wasm applications, you need a VM that supports Wasm Garbage Collection (GC), for example, Node.js or Deno. Wasmtime, WasmEdge, and others are still working towards full Wasm GC support.</p><p id="-erzqlj_532">To import a WASI function, use the <code class="code" id="-erzqlj_537">@WasmImport</code> annotation:</p><div class="code-block" data-lang="kotlin">
import kotlin.wasm.WasmImport

@WasmImport(&quot;wasi_snapshot_preview1&quot;, &quot;clock_time_get&quot;)
private external fun wasiRawClockTimeGet(clockId: Int, precision: Long, resultPtr: Int): Int
</div><p id="-erzqlj_534"><a href="https://github.com/Kotlin/kotlin-wasm-examples/tree/main/wasi-example" id="-erzqlj_538" data-external="true" rel="noopener noreferrer" target="_blank">You can find a full example in our GitHub repository</a>.</p><aside class="prompt" data-type="note" data-title="" id="-erzqlj_535"><p id="-erzqlj_539">It isn't possible to use <a href="wasm-js-interop.html" id="-erzqlj_540">interoperability with JavaScript</a>, while targeting <code class="code" id="-erzqlj_541">wasmWasi</code>.</p></aside></section><section class="chapter"><h3 id="kotlin-wasm-api-improvements" data-toc="kotlin-wasm-api-improvements">Kotlin/Wasm API improvements</h3><p id="-erzqlj_542">This release delivers several quality-of-life improvements to the Kotlin/Wasm API. For example, you're no longer required to return a value for DOM event listeners:</p><div class="table-wrapper"><table class="wide" id="-erzqlj_543"><thead><tr class="ijRowHead" id="-erzqlj_544"><th id="-erzqlj_546"><p>Before 1.9.20</p></th><th id="-erzqlj_547"><p>In 1.9.20</p></th></tr></thead><tbody><tr id="-erzqlj_545"><td id="-erzqlj_548"><div class="code-block" data-lang="kotlin">
fun main() {
    window.onload = {
        document.body?.sayHello()
        null
    }
}
</div></td><td id="-erzqlj_549"><div class="code-block" data-lang="kotlin">
fun main() {
    window.onload = { document.body?.sayHello() }
}
</div></td></tr></tbody></table></div></section></section><section class="chapter"><h2 id="gradle" data-toc="gradle">Gradle</h2><p id="-erzqlj_552">Kotlin 1.9.20 is fully compatible with Gradle 6.8.3 through 8.1. You can also use Gradle versions up to the latest Gradle release, but if you do, keep in mind that you might encounter deprecation warnings or some new Gradle features might not work.</p><p id="-erzqlj_553">This version brings the following changes:</p><ul class="list _bullet" id="-erzqlj_554"><li class="list__item" id="-erzqlj_558"><p id="-erzqlj_561"><a href="#support-for-test-fixtures-to-access-internal-declarations" id="-erzqlj_562">Support for test fixtures to access internal declarations</a></p></li><li class="list__item" id="-erzqlj_559"><p id="-erzqlj_563"><a href="#new-property-to-configure-paths-to-konan-directories" id="-erzqlj_564">New property to configure paths to Konan directories</a></p></li><li class="list__item" id="-erzqlj_560"><p id="-erzqlj_565"><a href="#new-build-report-metrics-for-kotlin-native-tasks" id="-erzqlj_566">New build report metrics for Kotlin/Native tasks</a></p></li></ul><section class="chapter"><h3 id="support-for-test-fixtures-to-access-internal-declarations" data-toc="support-for-test-fixtures-to-access-internal-declarations">Support for test fixtures to access internal declarations</h3><p id="-erzqlj_567">In Kotlin 1.9.20, if you use Gradle's <code class="code" id="-erzqlj_568">java-test-fixtures</code> plugin, then your <a href="https://docs.gradle.org/current/userguide/java_testing.html#sec:java_test_fixtures" id="-erzqlj_569" data-external="true" rel="noopener noreferrer" target="_blank">test fixtures</a> now have access to <code class="code" id="-erzqlj_570">internal</code> declarations within main source set classes. In addition, any test sources can also see any <code class="code" id="-erzqlj_571">internal</code> declarations within test fixtures classes.</p></section><section class="chapter"><h3 id="new-property-to-configure-paths-to-konan-directories" data-toc="new-property-to-configure-paths-to-konan-directories">New property to configure paths to Konan directories</h3><p id="-erzqlj_572">In Kotlin 1.9.20, the <code class="code" id="-erzqlj_574">kotlin.data.dir</code> Gradle property is available to customize your path to the <code class="code" id="-erzqlj_575">~/.konan</code> directory so that you don't have to configure it through the environment variable <code class="code" id="-erzqlj_576">KONAN_DATA_DIR</code>.</p><p id="-erzqlj_573">Alternatively, you can use the <code class="code" id="-erzqlj_577">-Xkonan-data-dir</code> compiler option to configure your custom path to the <code class="code" id="-erzqlj_578">~/.konan</code> directory via the <code class="code" id="-erzqlj_579">cinterop</code> and <code class="code" id="-erzqlj_580">konanc</code> tools.</p></section><section class="chapter"><h3 id="new-build-report-metrics-for-kotlin-native-tasks" data-toc="new-build-report-metrics-for-kotlin-native-tasks">New build report metrics for Kotlin/Native tasks</h3><p id="-erzqlj_581">In Kotlin 1.9.20, Gradle build reports now include metrics for Kotlin/Native tasks. Here is an example of a build report containing these metrics:</p><div class="code-block" data-lang="none">
Total time for Kotlin tasks: 20.81 s (93.1 % of all tasks time)
Time   |% of Kotlin time|Task                            
15.24 s|73.2 %          |:compileCommonMainKotlinMetadata
5.57 s |26.8 %          |:compileNativeMainKotlinMetadata

Task ':compileCommonMainKotlinMetadata' finished in 15.24 s
Task info:
  Kotlin language version: 2.0
Time metrics:
  Total Gradle task time: 15.24 s
  Spent time before task action: 0.16 s
  Task action before worker execution: 0.21 s
  Run native in process: 2.70 s
    Run entry point: 2.64 s
Size metrics:
  Start time of task action: 2023-07-27T11:04:17

Task ':compileNativeMainKotlinMetadata' finished in 5.57 s
Task info:
  Kotlin language version: 2.0
Time metrics:
  Total Gradle task time: 5.57 s
  Spent time before task action: 0.04 s
  Task action before worker execution: 0.02 s
  Run native in process: 1.48 s
    Run entry point: 1.47 s
Size metrics:
  Start time of task action: 2023-07-27T11:04:32
</div><p id="-erzqlj_583">In addition, the <code class="code" id="-erzqlj_586">kotlin.experimental.tryK2</code> build report now includes any Kotlin/Native tasks that were compiled and lists the language version used:</p><div class="code-block" data-lang="none">
##### 'kotlin.experimental.tryK2' results #####
:lib:compileCommonMainKotlinMetadata: 2.0 language version
:lib:compileKotlinJvm: 2.0 language version
:lib:compileKotlinIosArm64: 2.0 language version
:lib:compileKotlinIosSimulatorArm64: 2.0 language version
:lib:compileKotlinLinuxX64: 2.0 language version
:lib:compileTestKotlinJvm: 2.0 language version
:lib:compileTestKotlinIosSimulatorArm64: 2.0 language version
:lib:compileTestKotlinLinuxX64: 2.0 language version
##### 100% (8/8) tasks have been compiled with Kotlin 2.0 #####
</div><aside class="prompt" data-type="note" data-title="" id="-erzqlj_585"><p id="-erzqlj_587">If you use Gradle 8.0, you might come across some problems with build reports, especially when Gradle configuration caching is enabled. This is a known issue, which is fixed in Gradle 8.1 and later.</p></aside></section></section><section class="chapter"><h2 id="standard-library" data-toc="standard-library">Standard library</h2><p id="-erzqlj_588">In Kotlin 1.9.20, the <a href="#the-kotlin-native-standard-library-becomes-stable" id="-erzqlj_593">Kotlin/Native standard library becomes Stable</a>, and there are some new features:</p><ul class="list _bullet" id="-erzqlj_589"><li class="list__item" id="-erzqlj_594"><p id="-erzqlj_596"><a href="#replacement-of-the-enum-class-values-generic-function" id="-erzqlj_597">Replacement of the Enum class values generic function</a></p></li><li class="list__item" id="-erzqlj_595"><p id="-erzqlj_598"><a href="#improved-performance-of-hashmap-operations-in-kotlin-js" id="-erzqlj_599">Improved performance of HashMap operations in Kotlin/JS</a></p></li></ul><section class="chapter"><h3 id="replacement-of-the-enum-class-values-generic-function" data-toc="replacement-of-the-enum-class-values-generic-function">Replacement of the Enum class values generic function</h3><aside class="prompt" data-type="warning" data-title="" id="-erzqlj_600"><p id="-erzqlj_606">This feature is <a href="components-stability.html#stability-levels-explained" id="-erzqlj_607">Experimental</a>. It may be dropped or changed at any time. Opt-in is required (see details below). Use it only for evaluation purposes. We would appreciate your feedback on it in <a href="https://kotl.in/issue" id="-erzqlj_608" data-external="true" rel="noopener noreferrer" target="_blank">YouTrack</a>.</p></aside><p id="-erzqlj_601">In Kotlin 1.9.0, the <code class="code" id="-erzqlj_609">entries</code> property for enum classes became Stable. The <code class="code" id="-erzqlj_610">entries</code> property is a modern and performant replacement for the synthetic <code class="code" id="-erzqlj_611">values()</code> function. As part of Kotlin 1.9.20, there is a replacement for the generic <code class="code" id="-erzqlj_612">enumValues&lt;T&gt;()</code> function: <code class="code" id="-erzqlj_613">enumEntries&lt;T&gt;()</code>.</p><aside class="prompt" data-type="tip" data-title="" id="-erzqlj_602"><p id="-erzqlj_614">The <code class="code" id="-erzqlj_615">enumValues&lt;T&gt;()</code> function is still supported, but we recommend that you use the <code class="code" id="-erzqlj_616">enumEntries&lt;T&gt;()</code> function instead because it has less performance impact. Every time you call <code class="code" id="-erzqlj_617">enumValues&lt;T&gt;()</code>, a new array is created, whereas whenever you call <code class="code" id="-erzqlj_618">enumEntries&lt;T&gt;()</code>, the same list is returned each time, which is far more efficient.</p></aside><p id="-erzqlj_603">For example:</p><div class="code-block" data-lang="kotlin">
enum class RGB { RED, GREEN, BLUE }

@OptIn(ExperimentalStdlibApi::class)
inline fun &lt;reified T : Enum&lt;T&gt;&gt; printAllValues() {
    print(enumEntries&lt;T&gt;().joinToString { it.name })
}

printAllValues&lt;RGB&gt;()
// RED, GREEN, BLUE
</div><section class="chapter"><h4 id="how-to-enable-the-enumentries-function" data-toc="how-to-enable-the-enumentries-function">How to enable the enumEntries function</h4><p id="-erzqlj_619">To try this feature, opt in with <code class="code" id="-erzqlj_620">@OptIn(ExperimentalStdlibApi)</code> and use language version 1.9 or later. If you use the latest version of the Kotlin Gradle plugin, you don't need to specify the language version to test the feature.</p></section></section><section class="chapter"><h3 id="the-kotlin-native-standard-library-becomes-stable" data-toc="the-kotlin-native-standard-library-becomes-stable">The Kotlin/Native standard library becomes Stable</h3><p id="-erzqlj_621">In Kotlin 1.9.0, we <a href="whatsnew19.html#the-kotlin-native-standard-library-s-journey-towards-stabilization" id="-erzqlj_624">explained</a> the actions we've taken to bring the Kotlin/Native standard library closer to our goal of stabilization. In Kotlin 1.9.20, we finally conclude this work and make the Kotlin/Native standard library Stable. Here are some highlights from this release:</p><ul class="list _bullet" id="-erzqlj_622"><li class="list__item" id="-erzqlj_625"><p id="-erzqlj_629">The <a href="https://kotlinlang.org/api/latest/jvm/stdlib/kotlinx.cinterop/-vector128/" id="-erzqlj_630" data-external="true" rel="noopener noreferrer" target="_blank"><code class="code" id="-erzqlj_633">Vector128</code></a> class was moved from the <code class="code" id="-erzqlj_631">kotlin.native</code> package to the <code class="code" id="-erzqlj_632">kotlinx.cinterop</code> package.</p></li><li class="list__item" id="-erzqlj_626"><p id="-erzqlj_634">The opt-in requirement level for <code class="code" id="-erzqlj_635">ExperimentalNativeApi</code> and <code class="code" id="-erzqlj_636">NativeRuntimeApi</code> annotations, which were introduced as part of Kotlin 1.9.0, has been raised from <code class="code" id="-erzqlj_637">WARNING</code> to <code class="code" id="-erzqlj_638">ERROR</code>.</p></li><li class="list__item" id="-erzqlj_627"><p id="-erzqlj_639">Kotlin/Native collections now detect concurrent modifications, for example, in the <a href="https://kotlinlang.org/api/latest/jvm/stdlib/kotlin.collections/-array-list/" id="-erzqlj_640" data-external="true" rel="noopener noreferrer" target="_blank"><code class="code" id="-erzqlj_642">ArrayList</code></a> and <a href="https://kotlinlang.org/api/latest/jvm/stdlib/kotlin.collections/-hash-map/" id="-erzqlj_641" data-external="true" rel="noopener noreferrer" target="_blank"><code class="code" id="-erzqlj_643">HashMap</code></a> collections.</p></li><li class="list__item" id="-erzqlj_628"><p id="-erzqlj_644">The <a href="https://kotlinlang.org/api/latest/jvm/stdlib/kotlin/-throwable/print-stack-trace.html" id="-erzqlj_647" data-external="true" rel="noopener noreferrer" target="_blank"><code class="code" id="-erzqlj_651">printStackTrace()</code></a> function from the <code class="code" id="-erzqlj_648">Throwable</code> class now prints to <code class="code" id="-erzqlj_649">STDERR</code> instead of <code class="code" id="-erzqlj_650">STDOUT</code>.</p><aside class="prompt" data-type="warning" data-title="" id="-erzqlj_645"><p id="-erzqlj_652">The output format of <code class="code" id="-erzqlj_653">printStackTrace()</code> isn't Stable and is subject to change.</p></aside><p id="-erzqlj_646"></p></li></ul><section class="chapter"><h4 id="improvements-to-the-atomics-api" data-toc="improvements-to-the-atomics-api">Improvements to the Atomics API</h4><p id="-erzqlj_654">In Kotlin 1.9.0, we said that the Atomics API would be ready to become Stable when the Kotlin/Native standard library becomes Stable. Kotlin 1.9.20 includes the following additional changes:</p><ul class="list _bullet" id="-erzqlj_655"><li class="list__item" id="-erzqlj_657"><p id="-erzqlj_661">Experimental <code class="code" id="-erzqlj_664">AtomicIntArray</code>, <code class="code" id="-erzqlj_665">AtomicLongArray</code>, and <code class="code" id="-erzqlj_666">AtomicArray&lt;T&gt;</code> classes are introduced. These new classes are designed specifically to be consistent with Java's atomic arrays so that in the future, they can be included in the common standard library.</p><aside class="prompt" data-type="warning" data-title="" id="-erzqlj_662"><p id="-erzqlj_667">The <code class="code" id="-erzqlj_668">AtomicIntArray</code>, <code class="code" id="-erzqlj_669">AtomicLongArray</code>, and <code class="code" id="-erzqlj_670">AtomicArray&lt;T&gt;</code> classes are <a href="components-stability.html#stability-levels-explained" id="-erzqlj_671">Experimental</a>. They may be dropped or changed at any time. To try them, opt in with <code class="code" id="-erzqlj_672">@OptIn(ExperimentalStdlibApi)</code>. Use them only for evaluation purposes. We would appreciate your feedback in <a href="https://kotl.in/issue" id="-erzqlj_673" data-external="true" rel="noopener noreferrer" target="_blank">YouTrack</a>.</p></aside><p id="-erzqlj_663"></p></li><li class="list__item" id="-erzqlj_658"><p id="-erzqlj_674">In the <code class="code" id="-erzqlj_675">kotlin.native.concurrent</code> package, the Atomics API that was deprecated in Kotlin 1.9.0 with deprecation level <code class="code" id="-erzqlj_676">WARNING</code> has had its deprecation level raised to <code class="code" id="-erzqlj_677">ERROR</code>.</p></li><li class="list__item" id="-erzqlj_659"><p id="-erzqlj_678">In the <code class="code" id="-erzqlj_679">kotlin.concurrent</code> package, member functions of the <a href="https://kotlinlang.org/api/latest/jvm/stdlib/kotlin.concurrent/-atomic-int/index.html" id="-erzqlj_680" data-external="true" rel="noopener noreferrer" target="_blank"><code class="code" id="-erzqlj_683">AtomicInt</code></a> and <a href="https://kotlinlang.org/api/latest/jvm/stdlib/kotlin.concurrent/-atomic-long/index.html" id="-erzqlj_681" data-external="true" rel="noopener noreferrer" target="_blank"><code class="code" id="-erzqlj_684">AtomicLong</code></a> classes that had deprecation level: <code class="code" id="-erzqlj_682">ERROR</code>, have been removed.</p></li><li class="list__item" id="-erzqlj_660"><p id="-erzqlj_685">All <a href="https://kotlinlang.org/api/latest/jvm/stdlib/kotlin.concurrent/-atomic-reference/#functions" id="-erzqlj_686" data-external="true" rel="noopener noreferrer" target="_blank">member functions</a> of the <code class="code" id="-erzqlj_687">AtomicReference</code> class now use atomic intrinsic functions.</p></li></ul><p id="-erzqlj_656">For more information on all of the changes in Kotlin 1.9.20, see our <a href="https://youtrack.jetbrains.com/issue/KT-61028/Behavioural-changes-to-the-Native-stdlib-API" id="-erzqlj_688" data-external="true" rel="noopener noreferrer" target="_blank">YouTrack ticket</a>.</p></section></section><section class="chapter"><h3 id="improved-performance-of-hashmap-operations-in-kotlin-js" data-toc="improved-performance-of-hashmap-operations-in-kotlin-js">Improved performance of HashMap operations in Kotlin/JS</h3><p id="-erzqlj_689">Kotlin 1.9.20 improves the performance of <code class="code" id="-erzqlj_691">HashMap</code> operations and reduces their memory footprint in Kotlin/JS. Internally, Kotlin/JS has changed its internal implementation to open addressing. This means that you should see performance improvements when you:</p><ul class="list _bullet" id="-erzqlj_690"><li class="list__item" id="-erzqlj_692"><p id="-erzqlj_695">Insert new elements into a <code class="code" id="-erzqlj_696">HashMap</code>.</p></li><li class="list__item" id="-erzqlj_693"><p id="-erzqlj_697">Search for existing elements in a <code class="code" id="-erzqlj_698">HashMap</code>.</p></li><li class="list__item" id="-erzqlj_694"><p id="-erzqlj_699">Iterate through keys or values in a <code class="code" id="-erzqlj_700">HashMap</code>.</p></li></ul></section></section><section class="chapter"><h2 id="documentation-updates" data-toc="documentation-updates">Documentation updates</h2><p id="-erzqlj_701">The Kotlin documentation has received some notable changes:</p><ul class="list _bullet" id="-erzqlj_702"><li class="list__item" id="-erzqlj_703"><p id="-erzqlj_709">The <a href="https://kotlinlang.org/api/kotlinx-metadata-jvm/" id="-erzqlj_710" data-external="true" rel="noopener noreferrer" target="_blank">JVM Metadata</a> API reference &ndash; Explore how you can parse metadata with Kotlin/JVM.</p></li><li class="list__item" id="-erzqlj_704"><p id="-erzqlj_711"><a href="time-measurement.html" id="-erzqlj_712">Time measurement guide</a> &ndash; Learn how to calculate and measure time in Kotlin.</p></li><li class="list__item" id="-erzqlj_705"><p id="-erzqlj_713">Improved Collections chapter in the <a href="kotlin-tour-welcome.html" id="-erzqlj_714">tour of Kotlin</a> &ndash; Learn the fundamentals of the Kotlin programming language with chapters including both theory and practice.</p></li><li class="list__item" id="-erzqlj_706"><p id="-erzqlj_715"><a href="generics.html#definitely-non-nullable-types" id="-erzqlj_716">Definitely non-nullable types</a> &ndash; Learn about definitely non-nullable generic types.</p></li><li class="list__item" id="-erzqlj_707"><p id="-erzqlj_717">Improved <a href="arrays.html" id="-erzqlj_718">Arrays page</a> &ndash; Learn about arrays and when to use them.</p></li><li class="list__item" id="-erzqlj_708"><p id="-erzqlj_719"><a href="https://www.jetbrains.com/help/kotlin-multiplatform-dev/multiplatform-expect-actual.html" id="-erzqlj_720" data-external="true" rel="noopener noreferrer" target="_blank">Expected and actual declarations in Kotlin Multiplatform</a> &ndash; Learn about the Kotlin mechanism of expected and actual declarations in Kotlin Multiplatform.</p></li></ul></section><section class="chapter"><h2 id="install-kotlin-1-9-20" data-toc="install-kotlin-1-9-20">Install Kotlin 1.9.20</h2><section class="chapter"><h3 id="check-the-ide-version" data-toc="check-the-ide-version">Check the IDE version</h3><p id="-erzqlj_723"><a href="https://www.jetbrains.com/idea/download/" id="-erzqlj_726" data-external="true" rel="noopener noreferrer" target="_blank">IntelliJ IDEA</a> 2023.1.x and 2023.2.x automatically suggest updating the Kotlin plugin to version 1.9.20. IntelliJ IDEA 2023.3 will include the Kotlin 1.9.20 plugin.</p><p id="-erzqlj_724">Android Studio Hedgehog (231) and Iguana (232) will support Kotlin 1.9.20 in their upcoming releases.</p><p id="-erzqlj_725">The new command&ndash;line compiler is available for download on the <a href="https://github.com/JetBrains/kotlin/releases/tag/v1.9.20" id="-erzqlj_727" data-external="true" rel="noopener noreferrer" target="_blank">GitHub release page</a>.</p></section><section class="chapter"><h3 id="configure-gradle-settings" data-toc="configure-gradle-settings">Configure Gradle settings</h3><p id="-erzqlj_728">To download Kotlin artifacts and dependencies, update your <code class="code" id="-erzqlj_731">settings.gradle(.kts)</code> file to use the Maven Central repository:</p><div class="code-block" data-lang="kotlin">
pluginManagement {
    repositories {
        mavenCentral()
        gradlePluginPortal()
    }
}
</div><p id="-erzqlj_730">If the repository is not specified, Gradle uses the sunset JCenter repository, which could lead to issues with Kotlin artifacts.</p></section></section><div class="last-modified">01 July 2025</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom"><a href="whatsnew20.html" class="navigation-links__prev">What's new in Kotlin 2.0.0</a><a href="whatsnew19.html" class="navigation-links__next">What's new in Kotlin 1.9.0</a></div></article><div id="disqus_thread"></div></div></section></main></div><script src="https://resources.jetbrains.com/writerside/apidoc/6.22.0-b776/app.js"></script></body></html>