<!DOCTYPE html SYSTEM "about:legacy-compat">
<html lang="en-US" data-preset="contrast" data-primary-color="#307FFF"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="UTF-8"><meta name="built-on" content="2025-06-24T01:09:12.050223991"><link rel="canonical" href="https://kotlinlang.org/docs/whatsnew18.html" data-react-helmet="true"><script>
    (function (w, d, s, l, i) {
        w[l] = w[l] || [];
        w[l].push({'gtm.start': new Date().getTime(), event: 'gtm.js'});
        var f = d.getElementsByTagName(s)[0], j = d.createElement(s), dl = l != 'dataLayer' ? '&amp;l=' + l : '';
        j.async = true;
        j.src = '//www.googletagmanager.com/gtm.js?id=' + i + dl;
        f.parentNode.insertBefore(j, f);
    })(window, document, 'script', 'dataLayer', 'GTM-5P98');
</script>
<script src="https://resources.jetbrains.com/storage/help-app/v6/analytics.js"></script>
<title>What's new in Kotlin 1.8.0 | Kotlin Documentation</title><script type="application/json" id="virtual-toc-data">[{"id":"ide-support","level":0,"title":"IDE support","anchor":"#ide-support"},{"id":"kotlin-jvm","level":0,"title":"Kotlin/JVM","anchor":"#kotlin-jvm"},{"id":"ability-to-not-generate-type-use-and-type-parameter-annotation-targets","level":1,"title":"Ability to not generate TYPE_USE and TYPE_PARAMETER annotation targets","anchor":"#ability-to-not-generate-type-use-and-type-parameter-annotation-targets"},{"id":"a-new-compiler-option-for-disabling-optimizations","level":1,"title":"A new compiler option for disabling optimizations","anchor":"#a-new-compiler-option-for-disabling-optimizations"},{"id":"removal-of-the-old-backend","level":1,"title":"Removal of the old backend","anchor":"#removal-of-the-old-backend"},{"id":"support-for-lombok-s-builder-annotation","level":1,"title":"Support for Lombok\u0027s @Builder annotation","anchor":"#support-for-lombok-s-builder-annotation"},{"id":"kotlin-native","level":0,"title":"Kotlin/Native","anchor":"#kotlin-native"},{"id":"support-for-xcode-14-1","level":1,"title":"Support for Xcode 14.1","anchor":"#support-for-xcode-14-1"},{"id":"improved-objective-c-swift-interoperability","level":1,"title":"Improved Objective-C/Swift interoperability","anchor":"#improved-objective-c-swift-interoperability"},{"id":"dynamic-frameworks-by-default-in-the-cocoapods-gradle-plugin","level":1,"title":"Dynamic frameworks by default in the CocoaPods Gradle plugin","anchor":"#dynamic-frameworks-by-default-in-the-cocoapods-gradle-plugin"},{"id":"kotlin-multiplatform-a-new-android-source-set-layout","level":0,"title":"Kotlin Multiplatform: A new Android source set layout","anchor":"#kotlin-multiplatform-a-new-android-source-set-layout"},{"id":"kotlinsourceset-naming-schema","level":1,"title":"KotlinSourceSet naming schema","anchor":"#kotlinsourceset-naming-schema"},{"id":"sourcedirectories","level":1,"title":"SourceDirectories","anchor":"#sourcedirectories"},{"id":"the-location-of-the-androidmanifest-xml-file","level":1,"title":"The location of the AndroidManifest.xml file","anchor":"#the-location-of-the-androidmanifest-xml-file"},{"id":"the-relation-between-android-and-common-tests","level":1,"title":"The relation between Android and common tests","anchor":"#the-relation-between-android-and-common-tests"},{"id":"support-for-android-flavors","level":1,"title":"Support for Android flavors","anchor":"#support-for-android-flavors"},{"id":"configuration-and-setup","level":1,"title":"Configuration and setup","anchor":"#configuration-and-setup"},{"id":"kotlin-js","level":0,"title":"Kotlin/JS","anchor":"#kotlin-js"},{"id":"stable-js-ir-compiler-backend","level":1,"title":"Stable JS IR compiler backend","anchor":"#stable-js-ir-compiler-backend"},{"id":"new-settings-for-reporting-that-yarn-lock-has-been-updated","level":1,"title":"New settings for reporting that yarn.lock has been updated","anchor":"#new-settings-for-reporting-that-yarn-lock-has-been-updated"},{"id":"add-test-targets-for-browsers-via-gradle-properties","level":1,"title":"Add test targets for browsers via Gradle properties","anchor":"#add-test-targets-for-browsers-via-gradle-properties"},{"id":"new-approach-to-adding-css-support-to-your-project","level":1,"title":"New approach to adding CSS support to your project","anchor":"#new-approach-to-adding-css-support-to-your-project"},{"id":"gradle","level":0,"title":"Gradle","anchor":"#gradle"},{"id":"exposing-kotlin-compiler-options-as-gradle-lazy-properties","level":1,"title":"Exposing Kotlin compiler options as Gradle lazy properties","anchor":"#exposing-kotlin-compiler-options-as-gradle-lazy-properties"},{"id":"bumping-the-minimum-supported-versions","level":1,"title":"Bumping the minimum supported versions","anchor":"#bumping-the-minimum-supported-versions"},{"id":"ability-to-disable-the-kotlin-daemon-fallback-strategy","level":1,"title":"Ability to disable the Kotlin daemon fallback strategy","anchor":"#ability-to-disable-the-kotlin-daemon-fallback-strategy"},{"id":"usage-of-the-latest-kotlin-stdlib-version-in-transitive-dependencies","level":1,"title":"Usage of the latest kotlin-stdlib version in transitive dependencies","anchor":"#usage-of-the-latest-kotlin-stdlib-version-in-transitive-dependencies"},{"id":"obligatory-check-for-jvm-targets-of-related-kotlin-and-java-compile-tasks","level":1,"title":"Obligatory check for JVM targets of related Kotlin and Java compile tasks","anchor":"#obligatory-check-for-jvm-targets-of-related-kotlin-and-java-compile-tasks"},{"id":"resolution-of-kotlin-gradle-plugins-transitive-dependencies","level":1,"title":"Resolution of Kotlin Gradle plugins\u0027 transitive dependencies","anchor":"#resolution-of-kotlin-gradle-plugins-transitive-dependencies"},{"id":"deprecations-and-removals","level":1,"title":"Deprecations and removals","anchor":"#deprecations-and-removals"},{"id":"standard-library","level":0,"title":"Standard library","anchor":"#standard-library"},{"id":"updated-jvm-compilation-target","level":1,"title":"Updated JVM compilation target","anchor":"#updated-jvm-compilation-target"},{"id":"cbrt","level":1,"title":"cbrt()","anchor":"#cbrt"},{"id":"timeunit-conversion-between-java-and-kotlin","level":1,"title":"TimeUnit conversion between Java and Kotlin","anchor":"#timeunit-conversion-between-java-and-kotlin"},{"id":"comparable-and-subtractable-timemarks","level":1,"title":"Comparable and subtractable TimeMarks","anchor":"#comparable-and-subtractable-timemarks"},{"id":"recursive-copying-or-deletion-of-directories","level":1,"title":"Recursive copying or deletion of directories","anchor":"#recursive-copying-or-deletion-of-directories"},{"id":"java-optionals-extension-functions","level":1,"title":"Java Optionals extension functions","anchor":"#java-optionals-extension-functions"},{"id":"improved-kotlin-reflect-performance","level":1,"title":"Improved kotlin-reflect performance","anchor":"#improved-kotlin-reflect-performance"},{"id":"documentation-updates","level":0,"title":"Documentation updates","anchor":"#documentation-updates"},{"id":"revamped-and-new-pages","level":1,"title":"Revamped and new pages","anchor":"#revamped-and-new-pages"},{"id":"new-and-updated-tutorials","level":1,"title":"New and updated tutorials","anchor":"#new-and-updated-tutorials"},{"id":"install-kotlin-1-8-0","level":0,"title":"Install Kotlin 1.8.0","anchor":"#install-kotlin-1-8-0"},{"id":"compatibility-guide-for-kotlin-1-8-0","level":0,"title":"Compatibility guide for Kotlin 1.8.0","anchor":"#compatibility-guide-for-kotlin-1-8-0"}]</script><script type="application/json" id="topic-shortcuts"></script><link href="https://resources.jetbrains.com/writerside/apidoc/6.22.0-b776/app.css" rel="stylesheet"><link rel="icon" type="image/svg" sizes="16x16" href="https://kotlinlang.org/assets/images/favicon.svg?v2"><link rel="icon" type="image/x-icon" sizes="32x32" href="https://kotlinlang.org/assets/images/favicon.ico?v2"><link rel="icon" type="image/png" sizes="96x96" href="https://kotlinlang.org/assets/images/apple-touch-icon.png?v2"><link rel="icon" type="image/png" sizes="300x300" href="https://kotlinlang.org/assets/images/apple-touch-icon-72x72.png?v2"><link rel="icon" type="image/png" sizes="500x500" href="https://kotlinlang.org/assets/images/apple-touch-icon-114x114.png?v2"><meta name="image" content="https://kotlinlang.org/assets/images/open-graph/docs.png"><!-- Open Graph --><meta property="og:title" content="What's new in Kotlin 1.8.0 | Kotlin"><meta property="og:description" content=""><meta property="og:image" content="https://kotlinlang.org/assets/images/open-graph/docs.png"><meta property="og:site_name" content="Kotlin Help"><meta property="og:type" content="website"><meta property="og:locale" content="en_US"><meta property="og:url" content="https://kotlinlang.org/docs/whatsnew18.html"><!-- End Open Graph --><!-- Twitter Card --><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content="@kotlin"><meta name="twitter:title" content="What's new in Kotlin 1.8.0 | Kotlin"><meta name="twitter:description" content=""><meta name="twitter:creator" content="@kotlin"><meta name="twitter:image:src" content="https://kotlinlang.org/assets/images/open-graph/docs.png"><!-- End Twitter Card --><!-- Schema.org WebPage --><script type="application/ld+json">{
    "@context": "http://schema.org",
    "@type": "WebPage",
    "@id": "https://kotlinlang.org/docs/whatsnew18.html#webpage",
    "url": "https://kotlinlang.org/docs/whatsnew18.html",
    "name": "What's new in Kotlin 1.8.0 | Kotlin",
    "description": "",
    "image": "https://kotlinlang.org/assets/images/open-graph/docs.png",
    "inLanguage":"en-US"
}</script><!-- End Schema.org --><!-- Schema.org WebSite --><script type="application/ld+json">{
    "@type": "WebSite",
    "@id": "https://kotlinlang.org/docs/#website",
    "url": "https://kotlinlang.org/docs/",
    "name": "Kotlin Help"
}</script><!-- End Schema.org --><style>a[href="test-page.html"] { visibility: hidden; }</style></head><body data-id="whatsnew18" data-main-title="What's new in Kotlin 1.8.0" data-article-props="{&quot;seeAlsoStyle&quot;:&quot;links&quot;}" data-template="article" data-breadcrumbs="What's new in Kotlin///Earlier versions" data-edit-url="https://github.com/JetBrains/kotlin-web-site/edit/master/docs/topics/whatsnew/whatsnew18.md"><div class="wrapper"><main class="panel _main"><header class="panel__header"><div class="container"><h3>Kotlin  Help</h3><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="whatsnew18" id="whatsnew18.md">What's new in Kotlin 1.8.0</h1><p id="cqe84y_2"><span class="emphasis" id="cqe84y_15"><a href="releases.html#release-details" id="cqe84y_16">Released: 28 December 2022</a></span></p><p id="cqe84y_3">The Kotlin 1.8.0 release is out and here are some of its biggest highlights:</p><ul class="list _bullet" id="cqe84y_4"><li class="list__item" id="cqe84y_17"><p id="cqe84y_23"><a href="#recursive-copying-or-deletion-of-directories" id="cqe84y_24">New experimental functions for JVM: recursively copy or delete directory content</a></p></li><li class="list__item" id="cqe84y_18"><p id="cqe84y_25"><a href="#improved-kotlin-reflect-performance" id="cqe84y_26">Improved kotlin-reflect performance</a></p></li><li class="list__item" id="cqe84y_19"><p id="cqe84y_27"><a href="#a-new-compiler-option-for-disabling-optimizations" id="cqe84y_28">New -Xdebug compiler option for better debugging experience</a></p></li><li class="list__item" id="cqe84y_20"><p id="cqe84y_29"><a href="#updated-jvm-compilation-target" id="cqe84y_30"><code class="code" id="cqe84y_31">kotlin-stdlib-jdk7</code> and <code class="code" id="cqe84y_32">kotlin-stdlib-jdk8</code> merged into <code class="code" id="cqe84y_33">kotlin-stdlib</code></a></p></li><li class="list__item" id="cqe84y_21"><p id="cqe84y_34"><a href="#improved-objective-c-swift-interoperability" id="cqe84y_35">Improved Objective-C/Swift interoperability</a></p></li><li class="list__item" id="cqe84y_22"><p id="cqe84y_36"><a href="#gradle" id="cqe84y_37">Compatibility with Gradle 7.3</a></p></li></ul><section class="chapter"><h2 id="ide-support" data-toc="ide-support">IDE support</h2><p id="cqe84y_38">The Kotlin plugin that supports 1.8.0 is available for:</p><div class="table-wrapper"><table class="wide" id="cqe84y_39"><thead><tr class="ijRowHead" id="cqe84y_41"><th id="cqe84y_44"><p>IDE</p></th><th id="cqe84y_45"><p>Supported versions</p></th></tr></thead><tbody><tr id="cqe84y_42"><td id="cqe84y_46"><p>IntelliJ IDEA</p></td><td id="cqe84y_47"><p>2021.3, 2022.1, 2022.2</p></td></tr><tr id="cqe84y_43"><td id="cqe84y_48"><p>Android Studio</p></td><td id="cqe84y_49"><p>Electric Eel (221), Flamingo (222)</p></td></tr></tbody></table></div><aside class="prompt" data-type="note" data-title="" id="cqe84y_40"><p id="cqe84y_50">You can update your projects to Kotlin 1.8.0 in IntelliJ IDEA 2022.3 without updating the IDE plugin.</p><p id="cqe84y_51">To migrate existing projects to Kotlin 1.8.0 in IntelliJ IDEA 2022.3, change the Kotlin version to <code class="code" id="cqe84y_52">1.8.0</code> and reimport your Gradle or Maven project.</p></aside></section><section class="chapter"><h2 id="kotlin-jvm" data-toc="kotlin-jvm">Kotlin/JVM</h2><p id="cqe84y_53">Starting with version 1.8.0, the compiler can generate classes with a bytecode version corresponding to JVM 19. The new language version also includes:</p><ul class="list _bullet" id="cqe84y_54"><li class="list__item" id="cqe84y_59"><p id="cqe84y_63"><a href="#ability-to-not-generate-type-use-and-type-parameter-annotation-targets" id="cqe84y_64">A compiler option for switching off the generation of JVM annotation targets</a></p></li><li class="list__item" id="cqe84y_60"><p id="cqe84y_65"><a href="#a-new-compiler-option-for-disabling-optimizations" id="cqe84y_66">A new <code class="code" id="cqe84y_67">-Xdebug</code> compiler option for disabling optimizations</a></p></li><li class="list__item" id="cqe84y_61"><p id="cqe84y_68"><a href="#removal-of-the-old-backend" id="cqe84y_69">The removal of the old backend</a></p></li><li class="list__item" id="cqe84y_62"><p id="cqe84y_70"><a href="#support-for-lombok-s-builder-annotation" id="cqe84y_71">Support for Lombok's @Builder annotation</a></p></li></ul><section class="chapter"><h3 id="ability-to-not-generate-type-use-and-type-parameter-annotation-targets" data-toc="ability-to-not-generate-type-use-and-type-parameter-annotation-targets">Ability to not generate TYPE_USE and TYPE_PARAMETER annotation targets</h3><p id="cqe84y_72">If a Kotlin annotation has <code class="code" id="cqe84y_74">TYPE</code> among its Kotlin targets, the annotation maps to <code class="code" id="cqe84y_75">java.lang.annotation.ElementType.TYPE_USE</code> in its list of Java annotation targets. This is just like how the <code class="code" id="cqe84y_76">TYPE_PARAMETER</code> Kotlin target maps to the <code class="code" id="cqe84y_77">java.lang.annotation.ElementType.TYPE_PARAMETER</code> Java target. This is an issue for Android clients with API levels less than 26, which don't have these targets in the API.</p><p id="cqe84y_73">Starting with Kotlin 1.8.0, you can use the new compiler option <code class="code" id="cqe84y_78">-Xno-new-java-annotation-targets</code> to avoid generating the <code class="code" id="cqe84y_79">TYPE_USE</code> and <code class="code" id="cqe84y_80">TYPE_PARAMETER</code> annotation targets.</p></section><section class="chapter"><h3 id="a-new-compiler-option-for-disabling-optimizations" data-toc="a-new-compiler-option-for-disabling-optimizations">A new compiler option for disabling optimizations</h3><p id="cqe84y_81">Kotlin 1.8.0 adds a new <code class="code" id="cqe84y_84">-Xdebug</code> compiler option, which disables optimizations for a better debugging experience. For now, the option disables the &quot;was optimized out&quot; feature for coroutines. In the future, after we add more optimizations, this option will disable them, too.</p><p id="cqe84y_82">The &quot;was optimized out&quot; feature optimizes variables when you use suspend functions. However, it is difficult to debug code with optimized variables because you don't see their values.</p><aside class="prompt" data-type="warning" data-title="" id="cqe84y_83"><p id="cqe84y_85"><span class="control" id="cqe84y_86">Never use this option in production</span>: Disabling this feature via <code class="code" id="cqe84y_87">-Xdebug</code> can <a href="https://youtrack.jetbrains.com/issue/KT-48678/Coroutine-debugger-disable-was-optimised-out-compiler-feature#focus=Comments-27-6015585.0-0" id="cqe84y_88" data-external="true" rel="noopener noreferrer" target="_blank">cause memory leaks</a>.</p></aside></section><section class="chapter"><h3 id="removal-of-the-old-backend" data-toc="removal-of-the-old-backend">Removal of the old backend</h3><p id="cqe84y_89">In Kotlin 1.5.0, we <a href="whatsnew15.html#stable-jvm-ir-backend" id="cqe84y_90">announced</a> that the IR-based backend became <a href="components-stability.html" id="cqe84y_91">Stable</a>. That meant that the old backend from Kotlin 1.4.* was deprecated. In Kotlin 1.8.0, we've removed the old backend completely. By extension, we've removed the compiler option <code class="code" id="cqe84y_92">-Xuse-old-backend</code> and the Gradle <code class="code" id="cqe84y_93">useOldBackend</code> option.</p></section><section class="chapter"><h3 id="support-for-lombok-s-builder-annotation" data-toc="support-for-lombok-s-builder-annotation">Support for Lombok's @Builder annotation</h3><p id="cqe84y_94">The community has added so many votes for the <a href="https://youtrack.jetbrains.com/issue/KT-46959" id="cqe84y_97" data-external="true" rel="noopener noreferrer" target="_blank">Kotlin Lombok: Support generated builders (@Builder)</a> YouTrack issue that we just had to support the <a href="https://projectlombok.org/features/Builder" id="cqe84y_98" data-external="true" rel="noopener noreferrer" target="_blank">@Builder annotation</a>.</p><p id="cqe84y_95">We don't yet have plans to support the <code class="code" id="cqe84y_99">@SuperBuilder</code> or <code class="code" id="cqe84y_100">@Tolerate</code> annotations, but we'll reconsider if enough people vote for the <a href="https://youtrack.jetbrains.com/issue/KT-53563/Kotlin-Lombok-Support-SuperBuilder" id="cqe84y_101" data-external="true" rel="noopener noreferrer" target="_blank">@SuperBuilder</a> and <a href="https://youtrack.jetbrains.com/issue/KT-53564/Kotlin-Lombok-Support-Tolerate" id="cqe84y_102" data-external="true" rel="noopener noreferrer" target="_blank">@Tolerate</a> issues.</p><p id="cqe84y_96"><a href="lombok.html#gradle" id="cqe84y_103">Learn how to configure the Lombok compiler plugin</a>.</p></section></section><section class="chapter"><h2 id="kotlin-native" data-toc="kotlin-native">Kotlin/Native</h2><p id="cqe84y_104">Kotlin 1.8.0 includes changes to Objective-C and Swift interoperability, support for Xcode 14.1, and improvements to the CocoaPods Gradle plugin:</p><ul class="list _bullet" id="cqe84y_105"><li class="list__item" id="cqe84y_109"><p id="cqe84y_112"><a href="#support-for-xcode-14-1" id="cqe84y_113">Support for Xcode 14.1</a></p></li><li class="list__item" id="cqe84y_110"><p id="cqe84y_114"><a href="#improved-objective-c-swift-interoperability" id="cqe84y_115">Improved Objective-C/Swift interoperability</a></p></li><li class="list__item" id="cqe84y_111"><p id="cqe84y_116"><a href="#dynamic-frameworks-by-default-in-the-cocoapods-gradle-plugin" id="cqe84y_117">Dynamic frameworks by default in the CocoaPods Gradle plugin</a></p></li></ul><section class="chapter"><h3 id="support-for-xcode-14-1" data-toc="support-for-xcode-14-1">Support for Xcode 14.1</h3><p id="cqe84y_118">The Kotlin/Native compiler now supports the latest stable Xcode version, 14.1. The compatibility improvements include the following changes:</p><ul class="list _bullet" id="cqe84y_119"><li class="list__item" id="cqe84y_120"><p id="cqe84y_123">There's a new <code class="code" id="cqe84y_124">watchosDeviceArm64</code> preset for the watchOS target that supports Apple watchOS on ARM64 platforms.</p></li><li class="list__item" id="cqe84y_121"><p id="cqe84y_125">The Kotlin CocoaPods Gradle plugin no longer has bitcode embedding for Apple frameworks by default.</p></li><li class="list__item" id="cqe84y_122"><p id="cqe84y_126">Platform libraries were updated to reflect the changes to Objective-C frameworks for Apple targets.</p></li></ul></section><section class="chapter"><h3 id="improved-objective-c-swift-interoperability" data-toc="improved-objective-c-swift-interoperability">Improved Objective-C/Swift interoperability</h3><p id="cqe84y_127">To make Kotlin more interoperable with Objective-C and Swift, three new annotations were added:</p><ul class="list _bullet" id="cqe84y_128"><li class="list__item" id="cqe84y_131"><p id="cqe84y_134"><a href="https://kotlinlang.org/api/latest/jvm/stdlib/kotlin.native/-obj-c-name/" id="cqe84y_137" data-external="true" rel="noopener noreferrer" target="_blank"><code class="code" id="cqe84y_138">@ObjCName</code></a> allows you to specify a more idiomatic name in Swift or Objective-C, instead of renaming the Kotlin declaration.</p><p id="cqe84y_135">The annotation instructs the Kotlin compiler to use a custom Objective-C and Swift name for this class, property, parameter, or function:</p><div class="code-block" data-lang="kotlin">
@ObjCName(swiftName = &quot;MySwiftArray&quot;)
class MyKotlinArray {
    @ObjCName(&quot;index&quot;)
    fun indexOf(@ObjCName(&quot;of&quot;) element: String): Int = TODO()
}

// Usage with the ObjCName annotations
let array = MySwiftArray()
let index = array.index(of: &quot;element&quot;)
</div></li><li class="list__item" id="cqe84y_132"><p id="cqe84y_139"><a href="https://kotlinlang.org/api/latest/jvm/stdlib/kotlin.native/-hidden-from-obj-c/" id="cqe84y_141" data-external="true" rel="noopener noreferrer" target="_blank"><code class="code" id="cqe84y_142">@HiddenFromObjC</code></a> allows you to hide a Kotlin declaration from Objective-C.</p><p id="cqe84y_140">The annotation instructs the Kotlin compiler not to export a function or property to Objective-C and, consequently, Swift. This can make your Kotlin code more Objective-C/Swift-friendly.</p></li><li class="list__item" id="cqe84y_133"><p id="cqe84y_143"><a href="https://kotlinlang.org/api/latest/jvm/stdlib/kotlin.native/-should-refine-in-swift/" id="cqe84y_147" data-external="true" rel="noopener noreferrer" target="_blank"><code class="code" id="cqe84y_148">@ShouldRefineInSwift</code></a> is useful for replacing a Kotlin declaration with a wrapper written in Swift.</p><p id="cqe84y_144">The annotation instructs the Kotlin compiler to mark a function or property as <code class="code" id="cqe84y_149">swift_private</code> in the generated Objective-C API. Such declarations get the <code class="code" id="cqe84y_150">__</code> prefix, which makes them invisible to Swift code.</p><p id="cqe84y_145">You can still use these declarations in your Swift code to create a Swift-friendly API, but they won't be suggested by Xcode's autocompletion, for example.</p><p id="cqe84y_146">For more information on refining Objective-C declarations in Swift, see the <a href="https://developer.apple.com/documentation/swift/improving-objective-c-api-declarations-for-swift" id="cqe84y_151" data-external="true" rel="noopener noreferrer" target="_blank">official Apple documentation</a>.</p></li></ul><aside class="prompt" data-type="note" data-title="" id="cqe84y_129"><p id="cqe84y_152">The new annotations require <a href="opt-in-requirements.html" id="cqe84y_153">opt-in</a>.</p></aside><p id="cqe84y_130">The Kotlin team is very grateful to <a href="https://github.com/rickclephas" id="cqe84y_154" data-external="true" rel="noopener noreferrer" target="_blank">Rick Clephas</a> for implementing these annotations.</p></section><section class="chapter"><h3 id="dynamic-frameworks-by-default-in-the-cocoapods-gradle-plugin" data-toc="dynamic-frameworks-by-default-in-the-cocoapods-gradle-plugin">Dynamic frameworks by default in the CocoaPods Gradle plugin</h3><p id="cqe84y_155">Starting with Kotlin 1.8.0, Kotlin frameworks registered by the CocoaPods Gradle plugin are linked dynamically by default. The previous static implementation was inconsistent with the behavior of the Kotlin Gradle plugin.</p><div class="code-block" data-lang="kotlin">
kotlin {
    cocoapods {
        framework {
            baseName = &quot;MyFramework&quot;
            isStatic = false // Now dynamic by default
        }
    }
}
</div><p id="cqe84y_157">If you have an existing project with a static linking type and you upgrade to Kotlin 1.8.0 (or change the linking type explicitly), you may encounter an error with the project's execution. To fix it, close your Xcode project and run <code class="code" id="cqe84y_159">pod install</code> in the Podfile directory.</p><p id="cqe84y_158">For more information, see the <a href="https://www.jetbrains.com/help/kotlin-multiplatform-dev/multiplatform-cocoapods-dsl-reference.html" id="cqe84y_160" data-external="true" rel="noopener noreferrer" target="_blank">CocoaPods Gradle plugin DSL reference</a>.</p></section></section><section class="chapter"><h2 id="kotlin-multiplatform-a-new-android-source-set-layout" data-toc="kotlin-multiplatform-a-new-android-source-set-layout">Kotlin Multiplatform: A new Android source set layout</h2><p id="cqe84y_161">Kotlin 1.8.0 introduces a new Android source set layout that replaces the previous naming schema for directories, which is confusing in multiple ways.</p><p id="cqe84y_162">Consider an example of two <code class="code" id="cqe84y_171">androidTest</code> directories created in the current layout. One is for <code class="code" id="cqe84y_172">KotlinSourceSets</code> and the other is for <code class="code" id="cqe84y_173">AndroidSourceSets</code>:</p><ul class="list _bullet" id="cqe84y_163"><li class="list__item" id="cqe84y_174"><p id="cqe84y_177">They have different semantics: Kotlin's <code class="code" id="cqe84y_178">androidTest</code> belongs to the <code class="code" id="cqe84y_179">unitTest</code> type, whereas Android's belongs to the <code class="code" id="cqe84y_180">integrationTest</code> type.</p></li><li class="list__item" id="cqe84y_175"><p id="cqe84y_181">They create a confusing <code class="code" id="cqe84y_182">SourceDirectories</code> layout, as <code class="code" id="cqe84y_183">src/androidTest/kotlin</code> has a <code class="code" id="cqe84y_184">UnitTest</code> and <code class="code" id="cqe84y_185">src/androidTest/java</code> has an <code class="code" id="cqe84y_186">InstrumentedTest</code>.</p></li><li class="list__item" id="cqe84y_176"><p id="cqe84y_187">Both <code class="code" id="cqe84y_188">KotlinSourceSets</code> and <code class="code" id="cqe84y_189">AndroidSourceSets</code> use a similar naming schema for Gradle configurations, so the resulting configurations of <code class="code" id="cqe84y_190">androidTest</code> for both Kotlin's and Android's source sets are the same: <code class="code" id="cqe84y_191">androidTestImplementation</code>, <code class="code" id="cqe84y_192">androidTestApi</code>, <code class="code" id="cqe84y_193">androidTestRuntimeOnly</code>, and <code class="code" id="cqe84y_194">androidTestCompileOnly</code>.</p></li></ul><p id="cqe84y_164">To address these and other existing issues, we've introduced a new Android source set layout. Here are some of the key differences between the two layouts:</p><section class="chapter"><h3 id="kotlinsourceset-naming-schema" data-toc="kotlinsourceset-naming-schema">KotlinSourceSet naming schema</h3><div class="table-wrapper"><table class="wide" id="cqe84y_195"><thead><tr class="ijRowHead" id="cqe84y_198"><th id="cqe84y_200"><p>Current source set layout</p></th><th id="cqe84y_201"><p>New source set layout</p></th></tr></thead><tbody><tr id="cqe84y_199"><td id="cqe84y_202"><p><code class="code" id="cqe84y_204">targetName</code> + <code class="code" id="cqe84y_205">AndroidSourceSet.name</code></p></td><td id="cqe84y_203"><p><code class="code" id="cqe84y_206">targetName</code> + <code class="code" id="cqe84y_207">AndroidVariantType</code></p></td></tr></tbody></table></div><p id="cqe84y_196"><code class="code" id="cqe84y_208">{AndroidSourceSet.name}</code> maps to <code class="code" id="cqe84y_209">{KotlinSourceSet.name}</code> as follows:</p><div class="table-wrapper"><table class="wide" id="cqe84y_197"><thead><tr class="ijRowHead" id="cqe84y_210"><th id="cqe84y_214"></th><th id="cqe84y_215"><p>Current source set layout</p></th><th id="cqe84y_216"><p>New source set layout</p></th></tr></thead><tbody><tr id="cqe84y_211"><td id="cqe84y_217"><p>main</p></td><td id="cqe84y_218"><p>androidMain</p></td><td id="cqe84y_219"><p>androidMain</p></td></tr><tr id="cqe84y_212"><td id="cqe84y_220"><p>test</p></td><td id="cqe84y_221"><p>androidTest</p></td><td id="cqe84y_222"><p>android<b id="cqe84y_223">Unit</b>Test</p></td></tr><tr id="cqe84y_213"><td id="cqe84y_224"><p>androidTest</p></td><td id="cqe84y_225"><p>android<b id="cqe84y_227">Android</b>Test</p></td><td id="cqe84y_226"><p>android<b id="cqe84y_228">Instrumented</b>Test</p></td></tr></tbody></table></div></section><section class="chapter"><h3 id="sourcedirectories" data-toc="sourcedirectories">SourceDirectories</h3><div class="table-wrapper"><table class="wide" id="cqe84y_229"><thead><tr class="ijRowHead" id="cqe84y_232"><th id="cqe84y_234"><p>Current source set layout</p></th><th id="cqe84y_235"><p>New source set layout</p></th></tr></thead><tbody><tr id="cqe84y_233"><td id="cqe84y_236"><p>The layout adds additional <code class="code" id="cqe84y_238">/kotlin</code> SourceDirectories</p></td><td id="cqe84y_237"><p><code class="code" id="cqe84y_239">src/{AndroidSourceSet.name}/kotlin</code>, <code class="code" id="cqe84y_240">src/{KotlinSourceSet.name}/kotlin</code></p></td></tr></tbody></table></div><p id="cqe84y_230"><code class="code" id="cqe84y_241">{AndroidSourceSet.name}</code> maps to <code class="code" id="cqe84y_242">{SourceDirectories included}</code> as follows:</p><div class="table-wrapper"><table class="wide" id="cqe84y_231"><thead><tr class="ijRowHead" id="cqe84y_243"><th id="cqe84y_247"></th><th id="cqe84y_248"><p>Current source set layout</p></th><th id="cqe84y_249"><p>New source set layout</p></th></tr></thead><tbody><tr id="cqe84y_244"><td id="cqe84y_250"><p>main</p></td><td id="cqe84y_251"><p>src/androidMain/kotlin, src/main/kotlin, src/main/java</p></td><td id="cqe84y_252"><p>src/androidMain/kotlin, src/main/kotlin, src/main/java</p></td></tr><tr id="cqe84y_245"><td id="cqe84y_253"><p>test</p></td><td id="cqe84y_254"><p>src/androidTest/kotlin, src/test/kotlin, src/test/java</p></td><td id="cqe84y_255"><p>src/android<b id="cqe84y_256">Unit</b>Test/kotlin, src/test/kotlin, src/test/java</p></td></tr><tr id="cqe84y_246"><td id="cqe84y_257"><p>androidTest</p></td><td id="cqe84y_258"><p>src/android<b id="cqe84y_260">Android</b>Test/kotlin, src/androidTest/java</p></td><td id="cqe84y_259"><p>src/android<b id="cqe84y_261">Instrumented</b>Test/kotlin, src/androidTest/java, <b id="cqe84y_262">src/androidTest/kotlin</b></p></td></tr></tbody></table></div></section><section class="chapter"><h3 id="the-location-of-the-androidmanifest-xml-file" data-toc="the-location-of-the-androidmanifest-xml-file">The location of the AndroidManifest.xml file</h3><div class="table-wrapper"><table class="wide" id="cqe84y_263"><thead><tr class="ijRowHead" id="cqe84y_266"><th id="cqe84y_268"><p>Current source set layout</p></th><th id="cqe84y_269"><p>New source set layout</p></th></tr></thead><tbody><tr id="cqe84y_267"><td id="cqe84y_270"><p>src/{<b id="cqe84y_272">Android</b>SourceSet.name}/AndroidManifest.xml</p></td><td id="cqe84y_271"><p>src/{<b id="cqe84y_273">Kotlin</b>SourceSet.name}/AndroidManifest.xml</p></td></tr></tbody></table></div><p id="cqe84y_264"><code class="code" id="cqe84y_274">{AndroidSourceSet.name}</code> maps to<code class="code" id="cqe84y_275">{AndroidManifest.xml location}</code> as follows:</p><div class="table-wrapper"><table class="wide" id="cqe84y_265"><thead><tr class="ijRowHead" id="cqe84y_276"><th id="cqe84y_279"></th><th id="cqe84y_280"><p>Current source set layout</p></th><th id="cqe84y_281"><p>New source set layout</p></th></tr></thead><tbody><tr id="cqe84y_277"><td id="cqe84y_282"><p>main</p></td><td id="cqe84y_283"><p>src/main/AndroidManifest.xml</p></td><td id="cqe84y_284"><p>src/<b id="cqe84y_285">android</b>Main/AndroidManifest.xml</p></td></tr><tr id="cqe84y_278"><td id="cqe84y_286"><p>debug</p></td><td id="cqe84y_287"><p>src/debug/AndroidManifest.xml</p></td><td id="cqe84y_288"><p>src/<b id="cqe84y_289">android</b>Debug/AndroidManifest.xml</p></td></tr></tbody></table></div></section><section class="chapter"><h3 id="the-relation-between-android-and-common-tests" data-toc="the-relation-between-android-and-common-tests">The relation between Android and common tests</h3><p id="cqe84y_290">The new Android source set layout changes the relation between Android-instrumented tests (renamed to <code class="code" id="cqe84y_295">androidInstrumentedTest</code> in the new layout) and common tests.</p><p id="cqe84y_291">Previously, there was a default <code class="code" id="cqe84y_296">dependsOn</code> relation between <code class="code" id="cqe84y_297">androidAndroidTest</code> and <code class="code" id="cqe84y_298">commonTest</code>. In practice, it meant the following:</p><ul class="list _bullet" id="cqe84y_292"><li class="list__item" id="cqe84y_299"><p id="cqe84y_302">The code in <code class="code" id="cqe84y_303">commonTest</code> was available in <code class="code" id="cqe84y_304">androidAndroidTest</code>.</p></li><li class="list__item" id="cqe84y_300"><p id="cqe84y_305"><code class="code" id="cqe84y_306">expect</code> declarations in <code class="code" id="cqe84y_307">commonTest</code> had to have corresponding <code class="code" id="cqe84y_308">actual</code> implementations in <code class="code" id="cqe84y_309">androidAndroidTest</code>.</p></li><li class="list__item" id="cqe84y_301"><p id="cqe84y_310">Tests declared in <code class="code" id="cqe84y_311">commonTest</code> were also running as Android instrumented tests.</p></li></ul><p id="cqe84y_293">In the new Android source set layout, the <code class="code" id="cqe84y_312">dependsOn</code> relation is not added by default. If you prefer the previous behavior, manually declare this relation in your <code class="code" id="cqe84y_313">build.gradle.kts</code> file:</p><div class="code-block" data-lang="kotlin">
kotlin {
    // ...
    sourceSets {
        val commonTest by getting
        val androidInstrumentedTest by getting {
            dependsOn(commonTest)
        }
    }
}
</div></section><section class="chapter"><h3 id="support-for-android-flavors" data-toc="support-for-android-flavors">Support for Android flavors</h3><p id="cqe84y_314">Previously, the Kotlin Gradle plugin eagerly created source sets that correspond to Android source sets with <code class="code" id="cqe84y_318">debug</code> and <code class="code" id="cqe84y_319">release</code> build types or custom flavors like <code class="code" id="cqe84y_320">demo</code> and <code class="code" id="cqe84y_321">full</code>. It made them accessible by constructions like <code class="code" id="cqe84y_322">val androidDebug by getting { ... }</code>.</p><p id="cqe84y_315">In the new Android source set layout, those source sets are created in the <code class="code" id="cqe84y_323">afterEvaluate</code> phase. It makes such expressions invalid, leading to errors like <code class="code" id="cqe84y_324">org.gradle.api.UnknownDomainObjectException: KotlinSourceSet with name 'androidDebug' not found</code>.</p><p id="cqe84y_316">To work around that, use the new <code class="code" id="cqe84y_325">invokeWhenCreated()</code> API in your <code class="code" id="cqe84y_326">build.gradle.kts</code> file:</p><div class="code-block" data-lang="kotlin">
kotlin {
    // ...
    sourceSets.invokeWhenCreated(&quot;androidFreeDebug&quot;) {
        // ...
    }
}
</div></section><section class="chapter"><h3 id="configuration-and-setup" data-toc="configuration-and-setup">Configuration and setup</h3><p id="cqe84y_327">The new layout will become the default in future releases. You can enable it now with the following Gradle option:</p><div class="code-block" data-lang="none">
kotlin.mpp.androidSourceSetLayoutVersion=2
</div><aside class="prompt" data-type="note" data-title="" id="cqe84y_329"><p id="cqe84y_332">The new layout requires Android Gradle plugin 7.0 or later and is supported in Android Studio 2022.3 and later.</p></aside><p id="cqe84y_330">The usage of the previous Android-style directories is now discouraged. Kotlin 1.8.0 marks the start of the deprecation cycle, introducing a warning for the current layout. You can suppress the warning with the following Gradle property:</p><div class="code-block" data-lang="none">
kotlin.mpp.androidSourceSetLayoutVersion1.nowarn=true
</div></section></section><section class="chapter"><h2 id="kotlin-js" data-toc="kotlin-js">Kotlin/JS</h2><p id="cqe84y_333">Kotlin 1.8.0 stabilizes the JS IR compiler backend and brings new features to JavaScript-related Gradle build scripts:</p><ul class="list _bullet" id="cqe84y_334"><li class="list__item" id="cqe84y_339"><p id="cqe84y_343"><a href="#stable-js-ir-compiler-backend" id="cqe84y_344">Stable JS IR compiler backend</a></p></li><li class="list__item" id="cqe84y_340"><p id="cqe84y_345"><a href="#new-settings-for-reporting-that-yarn-lock-has-been-updated" id="cqe84y_346">New settings for reporting that yarn.lock has been updated</a></p></li><li class="list__item" id="cqe84y_341"><p id="cqe84y_347"><a href="#add-test-targets-for-browsers-via-gradle-properties" id="cqe84y_348">Add test targets for browsers via Gradle properties</a></p></li><li class="list__item" id="cqe84y_342"><p id="cqe84y_349"><a href="#new-approach-to-adding-css-support-to-your-project" id="cqe84y_350">New approach to adding CSS support to your project</a></p></li></ul><section class="chapter"><h3 id="stable-js-ir-compiler-backend" data-toc="stable-js-ir-compiler-backend">Stable JS IR compiler backend</h3><p id="cqe84y_351">Starting with this release, the <a href="js-ir-compiler.html" id="cqe84y_355">Kotlin/JS intermediate representation (IR-based) compiler</a> backend is Stable. It took a while to unify infrastructure for all three backends, but they now work with the same IR for Kotlin code.</p><p id="cqe84y_352">As a consequence of the stable JS IR compiler backend, the old one is deprecated from now on.</p><p id="cqe84y_353">Incremental compilation is enabled by default along with the stable JS IR compiler.</p><p id="cqe84y_354">If you still use the old compiler, switch your project to the new backend with the help of our <a href="js-ir-migration.html" id="cqe84y_356">migration guide</a>.</p></section><section class="chapter"><h3 id="new-settings-for-reporting-that-yarn-lock-has-been-updated" data-toc="new-settings-for-reporting-that-yarn-lock-has-been-updated">New settings for reporting that yarn.lock has been updated</h3><p id="cqe84y_357">If you use the <code class="code" id="cqe84y_362">yarn</code> package manager, there are three new special Gradle settings that could notify you if the <code class="code" id="cqe84y_363">yarn.lock</code> file has been updated. You can use these settings when you want to be notified if <code class="code" id="cqe84y_364">yarn.lock</code> has been changed silently during the CI build process.</p><p id="cqe84y_358">These three new Gradle properties are:</p><ul class="list _bullet" id="cqe84y_359"><li class="list__item" id="cqe84y_365"><p id="cqe84y_368"><code class="code" id="cqe84y_370">YarnLockMismatchReport</code>, which specifies how changes to the <code class="code" id="cqe84y_371">yarn.lock</code> file are reported. You can use one of the following values:</p><ul class="list _bullet" id="cqe84y_369"><li class="list__item" id="cqe84y_372"><p id="cqe84y_375"><code class="code" id="cqe84y_376">FAIL</code> fails the corresponding Gradle task. This is the default.</p></li><li class="list__item" id="cqe84y_373"><p id="cqe84y_377"><code class="code" id="cqe84y_378">WARNING</code> writes the information about changes in the warning log.</p></li><li class="list__item" id="cqe84y_374"><p id="cqe84y_379"><code class="code" id="cqe84y_380">NONE</code> disables reporting.</p></li></ul></li><li class="list__item" id="cqe84y_366"><p id="cqe84y_381"><code class="code" id="cqe84y_382">reportNewYarnLock</code>, which reports about the recently created <code class="code" id="cqe84y_383">yarn.lock</code> file explicitly. By default, this option is disabled: it's a common practice to generate a new <code class="code" id="cqe84y_384">yarn.lock</code> file at the first start. You can use this option to ensure that the file has been committed to your repository.</p></li><li class="list__item" id="cqe84y_367"><p id="cqe84y_385"><code class="code" id="cqe84y_386">yarnLockAutoReplace</code>, which replaces <code class="code" id="cqe84y_387">yarn.lock</code> automatically every time the Gradle task is run.</p></li></ul><p id="cqe84y_360">To use these options, update your build script file <code class="code" id="cqe84y_388">build.gradle.kts</code> as follows:</p><div class="code-block" data-lang="kotlin">
import org.jetbrains.kotlin.gradle.targets.js.yarn.YarnLockMismatchReport
import org.jetbrains.kotlin.gradle.targets.js.yarn.YarnRootExtension

rootProject.plugins.withType(org.jetbrains.kotlin.gradle.targets.js.yarn.YarnPlugin::class.java) {
    rootProject.the&lt;YarnRootExtension&gt;().yarnLockMismatchReport =
        YarnLockMismatchReport.WARNING // NONE | FAIL
    rootProject.the&lt;YarnRootExtension&gt;().reportNewYarnLock = false // true
    rootProject.the&lt;YarnRootExtension&gt;().yarnLockAutoReplace = false // true
}
</div></section><section class="chapter"><h3 id="add-test-targets-for-browsers-via-gradle-properties" data-toc="add-test-targets-for-browsers-via-gradle-properties">Add test targets for browsers via Gradle properties</h3><p id="cqe84y_389">Starting with Kotlin 1.8.0, you can set test targets for different browsers right in the Gradle properties file. Doing so shrinks the size of the build script file as you no longer need to write all targets in <code class="code" id="cqe84y_395">build.gradle.kts</code>.</p><p id="cqe84y_390">You can use this property to define a list of browsers for all modules, and then add specific browsers in the build scripts of particular modules.</p><p id="cqe84y_391">For example, the following line in your Gradle property file will run the test in Firefox and Safari for all modules:</p><div class="code-block" data-lang="none">
kotlin.js.browser.karma.browsers=firefox,safari
</div><p id="cqe84y_393">See the full list of <a href="https://github.com/JetBrains/kotlin/blob/master/libraries/tools/kotlin-gradle-plugin/src/common/kotlin/org/jetbrains/kotlin/gradle/targets/js/testing/karma/KotlinKarma.kt#L106" id="cqe84y_396" data-external="true" rel="noopener noreferrer" target="_blank">available values for the property on GitHub</a>.</p><p id="cqe84y_394">The Kotlin team is very grateful to <a href="https://github.com/mpetuska" id="cqe84y_397" data-external="true" rel="noopener noreferrer" target="_blank">Martynas Petu&scaron;ka</a> for implementing this feature.</p></section><section class="chapter"><h3 id="new-approach-to-adding-css-support-to-your-project" data-toc="new-approach-to-adding-css-support-to-your-project">New approach to adding CSS support to your project</h3><p id="cqe84y_398">This release provides a new approach to adding CSS support to your project. We assume that this will affect a lot of projects, so don't forget to update your Gradle build script files as described below.</p><p id="cqe84y_399">Before Kotlin 1.8.0, the <code class="code" id="cqe84y_403">cssSupport.enabled</code> property was used to add CSS support:</p><div class="code-block" data-lang="kotlin">
browser {
    commonWebpackConfig {
        cssSupport.enabled = true
    }
}
</div><p id="cqe84y_401">Now you should use the <code class="code" id="cqe84y_404">enabled.set()</code> method in the <code class="code" id="cqe84y_405">cssSupport {}</code> block:</p><div class="code-block" data-lang="kotlin">
browser {
    commonWebpackConfig {
        cssSupport {
            enabled.set(true)
        }
    }
}
</div></section></section><section class="chapter"><h2 id="gradle" data-toc="gradle">Gradle</h2><p id="cqe84y_406">Kotlin 1.8.0 <span class="control" id="cqe84y_416">fully</span> supports Gradle versions 7.2 and 7.3. You can also use Gradle versions up to the latest Gradle release, but if you do, keep in mind that you might encounter deprecation warnings or some new Gradle features might not work.</p><p id="cqe84y_407">This version brings lots of changes:</p><ul class="list _bullet" id="cqe84y_408"><li class="list__item" id="cqe84y_417"><p id="cqe84y_424"><a href="#exposing-kotlin-compiler-options-as-gradle-lazy-properties" id="cqe84y_425">Exposing Kotlin compiler options as Gradle lazy properties</a></p></li><li class="list__item" id="cqe84y_418"><p id="cqe84y_426"><a href="#bumping-the-minimum-supported-versions" id="cqe84y_427">Bumping the minimum supported versions</a></p></li><li class="list__item" id="cqe84y_419"><p id="cqe84y_428"><a href="#ability-to-disable-the-kotlin-daemon-fallback-strategy" id="cqe84y_429">Ability to disable the Kotlin daemon fallback strategy</a></p></li><li class="list__item" id="cqe84y_420"><p id="cqe84y_430"><a href="#usage-of-the-latest-kotlin-stdlib-version-in-transitive-dependencies" id="cqe84y_431">Usage of the latest kotlin-stdlib version in transitive dependencies</a></p></li><li class="list__item" id="cqe84y_421"><p id="cqe84y_432"><a href="#obligatory-check-for-jvm-targets-of-related-kotlin-and-java-compile-tasks" id="cqe84y_433">Obligatory check for JVM target compatibility equality of related Kotlin and Java compile tasks</a></p></li><li class="list__item" id="cqe84y_422"><p id="cqe84y_434"><a href="#resolution-of-kotlin-gradle-plugins-transitive-dependencies" id="cqe84y_435">Resolution of Kotlin Gradle plugins' transitive dependencies</a></p></li><li class="list__item" id="cqe84y_423"><p id="cqe84y_436"><a href="#deprecations-and-removals" id="cqe84y_437">Deprecations and removals</a></p></li></ul><section class="chapter"><h3 id="exposing-kotlin-compiler-options-as-gradle-lazy-properties" data-toc="exposing-kotlin-compiler-options-as-gradle-lazy-properties">Exposing Kotlin compiler options as Gradle lazy properties</h3><p id="cqe84y_438">To expose available Kotlin compiler options as <a href="https://docs.gradle.org/current/userguide/lazy_configuration.html" id="cqe84y_442" data-external="true" rel="noopener noreferrer" target="_blank">Gradle lazy properties</a> and to integrate them better into the Kotlin tasks, we made lots of changes:</p><ul class="list _bullet" id="cqe84y_439"><li class="list__item" id="cqe84y_443"><p id="cqe84y_450">Compile tasks have the new <code class="code" id="cqe84y_452">compilerOptions</code> input, which is similar to the existing <code class="code" id="cqe84y_453">kotlinOptions</code> but uses <a href="https://docs.gradle.org/current/javadoc/org/gradle/api/provider/Property.html" id="cqe84y_454" data-external="true" rel="noopener noreferrer" target="_blank"><code class="code" id="cqe84y_455">Property</code></a> from the Gradle Properties API as the return type:</p><div class="code-block" data-lang="kotlin">
tasks.named(&quot;compileKotlin&quot;, org.jetbrains.kotlin.gradle.tasks.KotlinJvmCompile::class.java) {
    compilerOptions {
        useK2.set(true)
    }
}
</div></li><li class="list__item" id="cqe84y_444"><p id="cqe84y_456">The Kotlin tools tasks <code class="code" id="cqe84y_457">KotlinJsDce</code> and <code class="code" id="cqe84y_458">KotlinNativeLink</code> have the new <code class="code" id="cqe84y_459">toolOptions</code> input, which is similar to the existing <code class="code" id="cqe84y_460">kotlinOptions</code> input.</p></li><li class="list__item" id="cqe84y_445"><p id="cqe84y_461">New inputs have the <a href="https://docs.gradle.org/current/javadoc/org/gradle/api/tasks/Nested.html" id="cqe84y_462" data-external="true" rel="noopener noreferrer" target="_blank"><code class="code" id="cqe84y_464">@Nested</code> Gradle annotation</a>. Every property inside the inputs has a related Gradle annotation, such as <a href="https://docs.gradle.org/current/userguide/more_about_tasks.html#sec:up_to_date_checks" id="cqe84y_463" data-external="true" rel="noopener noreferrer" target="_blank"><code class="code" id="cqe84y_465">@Input</code> or <code class="code" id="cqe84y_466">@Internal</code></a>.</p></li><li class="list__item" id="cqe84y_446"><p id="cqe84y_467">The Kotlin Gradle plugin API artifact has two new interfaces:</p><ul class="list _bullet" id="cqe84y_468"><li class="list__item" id="cqe84y_469"><p id="cqe84y_471"><code class="code" id="cqe84y_472">org.jetbrains.kotlin.gradle.tasks.KotlinCompilationTask</code>, which has the <code class="code" id="cqe84y_473">compilerOptions</code> input and the <code class="code" id="cqe84y_474">compileOptions()</code> method. All Kotlin compilation tasks implement this interface.</p></li><li class="list__item" id="cqe84y_470"><p id="cqe84y_475"><code class="code" id="cqe84y_476">org.jetbrains.kotlin.gradle.tasks.KotlinToolTask</code>, which has the <code class="code" id="cqe84y_477">toolOptions</code> input and the <code class="code" id="cqe84y_478">toolOptions()</code> method. All Kotlin tool tasks &ndash; <code class="code" id="cqe84y_479">KotlinJsDce</code>, <code class="code" id="cqe84y_480">KotlinNativeLink</code>, and <code class="code" id="cqe84y_481">KotlinNativeLinkArtifactTask</code> &ndash; implement this interface.</p></li></ul></li><li class="list__item" id="cqe84y_447"><p id="cqe84y_482">Some <code class="code" id="cqe84y_486">compilerOptions</code> use the new types instead of the <code class="code" id="cqe84y_487">String</code> type:</p><ul class="list _bullet" id="cqe84y_483"><li class="list__item" id="cqe84y_488"><p id="cqe84y_493"><a href="https://github.com/JetBrains/kotlin/blob/1.8.0/libraries/tools/kotlin-gradle-compiler-types/src/generated/kotlin/org/jetbrains/kotlin/gradle/dsl/JvmTarget.kt" id="cqe84y_494" data-external="true" rel="noopener noreferrer" target="_blank"><code class="code" id="cqe84y_495">JvmTarget</code></a></p></li><li class="list__item" id="cqe84y_489"><p id="cqe84y_496"><a href="https://github.com/JetBrains/kotlin/blob/1.8.0/libraries/tools/kotlin-gradle-compiler-types/src/generated/kotlin/org/jetbrains/kotlin/gradle/dsl/KotlinVersion.kt" id="cqe84y_497" data-external="true" rel="noopener noreferrer" target="_blank"><code class="code" id="cqe84y_500">KotlinVersion</code></a> (for the <code class="code" id="cqe84y_498">apiVersion</code> and the <code class="code" id="cqe84y_499">languageVersion</code> inputs)</p></li><li class="list__item" id="cqe84y_490"><p id="cqe84y_501"><a href="https://github.com/JetBrains/kotlin/blob/1.8.0/libraries/tools/kotlin-gradle-compiler-types/src/generated/kotlin/org/jetbrains/kotlin/gradle/dsl/JsMainFunctionExecutionMode.kt" id="cqe84y_502" data-external="true" rel="noopener noreferrer" target="_blank"><code class="code" id="cqe84y_503">JsMainFunctionExecutionMode</code></a></p></li><li class="list__item" id="cqe84y_491"><p id="cqe84y_504"><a href="https://github.com/JetBrains/kotlin/blob/1.8.0/libraries/tools/kotlin-gradle-compiler-types/src/generated/kotlin/org/jetbrains/kotlin/gradle/dsl/JsModuleKind.kt" id="cqe84y_505" data-external="true" rel="noopener noreferrer" target="_blank"><code class="code" id="cqe84y_506">JsModuleKind</code></a></p></li><li class="list__item" id="cqe84y_492"><p id="cqe84y_507"><a href="https://github.com/JetBrains/kotlin/blob/1.8.0/libraries/tools/kotlin-gradle-compiler-types/src/generated/kotlin/org/jetbrains/kotlin/gradle/dsl/JsSourceMapEmbedMode.kt" id="cqe84y_508" data-external="true" rel="noopener noreferrer" target="_blank"><code class="code" id="cqe84y_509">JsSourceMapEmbedMode</code></a></p></li></ul><p id="cqe84y_484">For example, you can use <code class="code" id="cqe84y_510">compilerOptions.jvmTarget.set(JvmTarget.JVM_11)</code> instead of <code class="code" id="cqe84y_511">kotlinOptions.jvmTarget = &quot;11&quot;</code>.</p><p id="cqe84y_485">The <code class="code" id="cqe84y_512">kotlinOptions</code> types didn't change, and they are internally converted to <code class="code" id="cqe84y_513">compilerOptions</code> types.</p></li><li class="list__item" id="cqe84y_448"><p id="cqe84y_514">The Kotlin Gradle plugin API is binary-compatible with previous releases. There are, however, some source and ABI-breaking changes in the <code class="code" id="cqe84y_515">kotlin-gradle-plugin</code> artifact. Most of these changes involve additional generic parameters to some internal types. One important change is that the <code class="code" id="cqe84y_516">KotlinNativeLink</code> task no longer inherits the <code class="code" id="cqe84y_517">AbstractKotlinNativeCompile</code> task.</p></li><li class="list__item" id="cqe84y_449"><p id="cqe84y_518"><code class="code" id="cqe84y_519">KotlinJsCompilerOptions.outputFile</code> and the related <code class="code" id="cqe84y_520">KotlinJsOptions.outputFile</code> options are deprecated. Use the <code class="code" id="cqe84y_521">Kotlin2JsCompile.outputFileProperty</code> task input instead.</p></li></ul><aside class="prompt" data-type="note" data-title="" id="cqe84y_440"><p id="cqe84y_522">The Kotlin Gradle plugin still adds the <code class="code" id="cqe84y_525">KotlinJvmOptions</code> DSL to the Android extension:</p><div class="code-block" data-lang="kotlin">
android { 
    kotlinOptions {
        jvmTarget = &quot;11&quot;
    }
}
</div><p id="cqe84y_524">This will be changed in the scope of <a href="https://youtrack.jetbrains.com/issue/KT-15370/Gradle-DSL-add-module-level-kotlin-options" id="cqe84y_526" data-external="true" rel="noopener noreferrer" target="_blank">this issue</a>, when the <code class="code" id="cqe84y_527">compilerOptions</code> DSL will be added to a module level.</p></aside><section class="chapter"><h4 id="limitations" data-toc="limitations">Limitations</h4><aside class="prompt" data-type="warning" data-title="" id="cqe84y_528"><p id="cqe84y_532">The <code class="code" id="cqe84y_533">kotlinOptions</code> task input and the <code class="code" id="cqe84y_534">kotlinOptions{...}</code> task DSL are in support mode and will be deprecated in upcoming releases. Improvements will be made only to <code class="code" id="cqe84y_535">compilerOptions</code> and <code class="code" id="cqe84y_536">toolOptions</code>.</p></aside><p id="cqe84y_529">Calling any setter or getter on <code class="code" id="cqe84y_537">kotlinOptions</code> delegates to the related property in the <code class="code" id="cqe84y_538">compilerOptions</code>. This introduces the following limitations:</p><ul class="list _bullet" id="cqe84y_530"><li class="list__item" id="cqe84y_539"><p id="cqe84y_541"><code class="code" id="cqe84y_542">compilerOptions</code> and <code class="code" id="cqe84y_543">kotlinOptions</code> cannot be changed in the task execution phase (see one exception in the paragraph below).</p></li><li class="list__item" id="cqe84y_540"><p id="cqe84y_544"><code class="code" id="cqe84y_545">freeCompilerArgs</code> returns an immutable <code class="code" id="cqe84y_546">List&lt;String&gt;</code>, which means that, for example, <code class="code" id="cqe84y_547">kotlinOptions.freeCompilerArgs.remove(&quot;something&quot;)</code> will fail.</p></li></ul><p id="cqe84y_531">Several plugins, including <code class="code" id="cqe84y_548">kotlin-dsl</code> and the Android Gradle plugin (AGP) with <a href="https://developer.android.com/jetpack/compose" id="cqe84y_549" data-external="true" rel="noopener noreferrer" target="_blank">Jetpack Compose</a> enabled, try to modify the <code class="code" id="cqe84y_550">freeCompilerArgs</code> attribute in the task execution phase. We've added a workaround for them in Kotlin 1.8.0. This workaround allows any build script or plugin to modify <code class="code" id="cqe84y_551">kotlinOptions.freeCompilerArgs</code> in the execution phase but produces a warning in the build log. To disable this warning, use the new Gradle property <code class="code" id="cqe84y_552">kotlin.options.suppressFreeCompilerArgsModificationWarning=true</code>. Gradle is going to add fixes for the <a href="https://github.com/gradle/gradle/issues/22091" id="cqe84y_553" data-external="true" rel="noopener noreferrer" target="_blank"><code class="code" id="cqe84y_555">kotlin-dsl</code> plugin</a> and <a href="https://issuetracker.google.com/u/1/issues/247544167" id="cqe84y_554" data-external="true" rel="noopener noreferrer" target="_blank">AGP with Jetpack Compose enabled</a>.</p></section></section><section class="chapter"><h3 id="bumping-the-minimum-supported-versions" data-toc="bumping-the-minimum-supported-versions">Bumping the minimum supported versions</h3><p id="cqe84y_556">Starting with Kotlin 1.8.0, the minimum supported Gradle version is 6.8.3 and the minimum supported Android Gradle plugin version is 4.1.3.</p><p id="cqe84y_557">See the <a href="gradle-configure-project.html#apply-the-plugin" id="cqe84y_558">Kotlin Gradle plugin compatibility with available Gradle versions in our documentation</a></p></section><section class="chapter"><h3 id="ability-to-disable-the-kotlin-daemon-fallback-strategy" data-toc="ability-to-disable-the-kotlin-daemon-fallback-strategy">Ability to disable the Kotlin daemon fallback strategy</h3><p id="cqe84y_559">There is a new Gradle property <code class="code" id="cqe84y_561">kotlin.daemon.useFallbackStrategy</code>, whose default value is <code class="code" id="cqe84y_562">true</code>. When the value is <code class="code" id="cqe84y_563">false</code>, builds fail on problems with the daemon's startup or communication. There is also a new <code class="code" id="cqe84y_564">useDaemonFallbackStrategy</code> property in Kotlin compile tasks, which takes priority over the Gradle property if you use both. If there is insufficient memory to run the compilation, you can see a message about it in the logs.</p><p id="cqe84y_560">The Kotlin compiler's fallback strategy is to run a compilation outside the Kotlin daemon if the daemon somehow fails. If the Gradle daemon is on, the compiler uses the &quot;In process&quot; strategy. If the Gradle daemon is off, the compiler uses the &quot;Out of process&quot; strategy. Learn more about these <a href="gradle-compilation-and-caches.html#defining-kotlin-compiler-execution-strategy" id="cqe84y_565">execution strategies in the documentation</a>. Note that silent fallback to another strategy can consume a lot of system resources or lead to non-deterministic builds; see this <a href="https://youtrack.jetbrains.com/issue/KT-48843/Add-ability-to-disable-Kotlin-daemon-fallback-strategy" id="cqe84y_566" data-external="true" rel="noopener noreferrer" target="_blank">YouTrack issue</a> for more details.</p></section><section class="chapter"><h3 id="usage-of-the-latest-kotlin-stdlib-version-in-transitive-dependencies" data-toc="usage-of-the-latest-kotlin-stdlib-version-in-transitive-dependencies">Usage of the latest kotlin-stdlib version in transitive dependencies</h3><p id="cqe84y_567">If you explicitly write Kotlin version 1.8.0 or higher in your dependencies, for example: <code class="code" id="cqe84y_572">implementation(&quot;org.jetbrains.kotlin:kotlin-stdlib:1.8.0&quot;)</code>, then the Kotlin Gradle Plugin will use that Kotlin version for transitive <code class="code" id="cqe84y_573">kotlin-stdlib-jdk7</code> and <code class="code" id="cqe84y_574">kotlin-stdlib-jdk8</code> dependencies. This is done to avoid class duplication from different stdlib versions (learn more about <a href="#updated-jvm-compilation-target" id="cqe84y_575">merging <code class="code" id="cqe84y_577">kotlin-stdlib-jdk7</code> and <code class="code" id="cqe84y_578">kotlin-stdlib-jdk8</code> into <code class="code" id="cqe84y_579">kotlin-stdlib</code></a>). You can disable this behavior with the <code class="code" id="cqe84y_576">kotlin.stdlib.jdk.variants.version.alignment</code> Gradle property:</p><div class="code-block" data-lang="none">
kotlin.stdlib.jdk.variants.version.alignment=false
</div><p id="cqe84y_569">If you run into issues with version alignment, align all versions via the Kotlin <a href="https://docs.gradle.org/current/userguide/platforms.html#sub:bom_import" id="cqe84y_580" data-external="true" rel="noopener noreferrer" target="_blank">BOM</a> by declaring a platform dependency on <code class="code" id="cqe84y_581">kotlin-bom</code> in your build script:</p><div class="code-block" data-lang="kotlin">
implementation(platform(&quot;org.jetbrains.kotlin:kotlin-bom:1.8.0&quot;))
</div><p id="cqe84y_571">Learn about other cases and our suggested solutions in <a href="gradle-configure-project.html#other-ways-to-align-versions" id="cqe84y_582">the documentation</a>.</p></section><section class="chapter"><h3 id="obligatory-check-for-jvm-targets-of-related-kotlin-and-java-compile-tasks" data-toc="obligatory-check-for-jvm-targets-of-related-kotlin-and-java-compile-tasks">Obligatory check for JVM targets of related Kotlin and Java compile tasks</h3><aside class="prompt" data-type="note" data-title="" id="cqe84y_583"><p id="cqe84y_587">This section applies to your JVM project even if your source files are only in Kotlin and you don't use Java.</p></aside><p id="cqe84y_584"><a href="https://youtrack.jetbrains.com/issue/KT-54993/Raise-kotlin.jvm.target.validation.mode-check-default-level-to-error-when-build-is-running-on-Gradle-8" id="cqe84y_588" data-external="true" rel="noopener noreferrer" target="_blank">Starting from this release</a>, the default value for the <a href="gradle-configure-project.html#check-for-jvm-target-compatibility-of-related-compile-tasks" id="cqe84y_589"><code class="code" id="cqe84y_591">kotlin.jvm.target.validation.mode</code> property</a> is <code class="code" id="cqe84y_590">error</code> for projects on Gradle 8.0+ (this version of Gradle has not been released yet), and the plugin will fail the build in the event of JVM target incompatibility.</p><p id="cqe84y_585">The shift of the default value from <code class="code" id="cqe84y_592">warning</code> to <code class="code" id="cqe84y_593">error</code> is a preparation step for a smooth migration to Gradle 8.0. <span class="control" id="cqe84y_594">We encourage you to set this property to <code class="code" id="cqe84y_596">error</code></span> and <a href="gradle-configure-project.html#gradle-java-toolchains-support" id="cqe84y_595">configure a toolchain</a> or align JVM versions manually.</p><p id="cqe84y_586">Learn more about <a href="gradle-configure-project.html#what-can-go-wrong-if-targets-are-incompatible" id="cqe84y_597">what can go wrong if you don't check the targets' compatibility</a>.</p></section><section class="chapter"><h3 id="resolution-of-kotlin-gradle-plugins-transitive-dependencies" data-toc="resolution-of-kotlin-gradle-plugins-transitive-dependencies">Resolution of Kotlin Gradle plugins' transitive dependencies</h3><p id="cqe84y_598">In Kotlin 1.7.0, we introduced <a href="whatsnew17.html#support-for-gradle-plugin-variants" id="cqe84y_602">support for Gradle plugin variants</a>. Because of these plugin variants, a build classpath can have different versions of the <a href="https://plugins.gradle.org/u/kotlin" id="cqe84y_603" data-external="true" rel="noopener noreferrer" target="_blank">Kotlin Gradle plugins</a> that depend on different versions of some dependency, usually <code class="code" id="cqe84y_604">kotlin-gradle-plugin-api</code>. This can lead to a resolution problem, and we would like to propose the following workaround, using the <code class="code" id="cqe84y_605">kotlin-dsl</code> plugin as an example.</p><p id="cqe84y_599">The <code class="code" id="cqe84y_606">kotlin-dsl</code> plugin in Gradle 7.6 depends on the <code class="code" id="cqe84y_607">org.jetbrains.kotlin.plugin.sam.with.receiver:1.7.10</code> plugin, which depends on <code class="code" id="cqe84y_608">kotlin-gradle-plugin-api:1.7.10</code>. If you add the <code class="code" id="cqe84y_609">org.jetbrains.kotlin.gradle.jvm:1.8.0</code> plugin, this <code class="code" id="cqe84y_610">kotlin-gradle-plugin-api:1.7.10</code> transitive dependency may lead to a dependency resolution error because of a mismatch between the versions (<code class="code" id="cqe84y_611">1.8.0</code> and <code class="code" id="cqe84y_612">1.7.10</code>) and the variant attributes' <a href="https://docs.gradle.org/current/javadoc/org/gradle/api/attributes/plugin/GradlePluginApiVersion.html" id="cqe84y_613" data-external="true" rel="noopener noreferrer" target="_blank"><code class="code" id="cqe84y_616">org.gradle.plugin.api-version</code></a> values. As a workaround, add this <a href="https://docs.gradle.org/current/userguide/dependency_constraints.html#sec:adding-constraints-transitive-deps" id="cqe84y_614" data-external="true" rel="noopener noreferrer" target="_blank">constraint</a> to align the versions. This workaround may be needed until we implement the <a href="https://youtrack.jetbrains.com/issue/KT-54691/Kotlin-Gradle-Plugin-libraries-alignment-platform" id="cqe84y_615" data-external="true" rel="noopener noreferrer" target="_blank">Kotlin Gradle Plugin libraries alignment platform</a>, which is in the plans:</p><div class="code-block" data-lang="kotlin">
dependencies {
    constraints {
        implementation(&quot;org.jetbrains.kotlin:kotlin-sam-with-receiver:1.8.0&quot;)
    }
}
</div><p id="cqe84y_601">This constraint forces the <code class="code" id="cqe84y_617">org.jetbrains.kotlin:kotlin-sam-with-receiver:1.8.0</code> version to be used in the build classpath for transitive dependencies. Learn more about one similar <a href="https://github.com/gradle/gradle/issues/22510#issuecomment-1292259298" id="cqe84y_618" data-external="true" rel="noopener noreferrer" target="_blank">case in the Gradle issue tracker</a>.</p></section><section class="chapter"><h3 id="deprecations-and-removals" data-toc="deprecations-and-removals">Deprecations and removals</h3><p id="cqe84y_619">In Kotlin 1.8.0, the deprecation cycle continues for the following properties and methods:</p><ul class="list _bullet" id="cqe84y_620"><li class="list__item" id="cqe84y_621"><p id="cqe84y_624"><a href="whatsnew17.html#changes-in-compile-tasks" id="cqe84y_625">In the notes for Kotlin 1.7.0</a> that the <code class="code" id="cqe84y_626">KotlinCompile</code> task still had the deprecated Kotlin property <code class="code" id="cqe84y_627">classpath</code>, which would be removed in future releases. Now, we've changed the deprecation level to <code class="code" id="cqe84y_628">error</code> for the <code class="code" id="cqe84y_629">KotlinCompile</code> task's <code class="code" id="cqe84y_630">classpath</code> property. All compile tasks use the <code class="code" id="cqe84y_631">libraries</code> input for a list of libraries required for compilation.</p></li><li class="list__item" id="cqe84y_622"><p id="cqe84y_632">We removed the <code class="code" id="cqe84y_633">kapt.use.worker.api</code> property that allowed running <a href="kapt.html" id="cqe84y_634">kapt</a> via the Gradle Workers API. By default, <a href="kapt.html#run-kapt-tasks-in-parallel" id="cqe84y_635">kapt has been using Gradle workers</a> since Kotlin 1.3.70, and we recommend sticking to this method.</p></li><li class="list__item" id="cqe84y_623"><p id="cqe84y_636">In Kotlin 1.7.0, we <a href="whatsnew17.html#deprecation-of-the-kotlin-compiler-execution-strategy-system-property" id="cqe84y_637">announced the start of a deprecation cycle for the <code class="code" id="cqe84y_639">kotlin.compiler.execution.strategy</code> property</a>. In this release, we removed this property. Learn how to <a href="gradle-compilation-and-caches.html#defining-kotlin-compiler-execution-strategy" id="cqe84y_638">define a Kotlin compiler execution strategy</a> in other ways.</p></li></ul></section></section><section class="chapter"><h2 id="standard-library" data-toc="standard-library">Standard library</h2><p id="cqe84y_640">Kotlin 1.8.0:</p><ul class="list _bullet" id="cqe84y_641"><li class="list__item" id="cqe84y_649"><p id="cqe84y_654">Updates <a href="#updated-jvm-compilation-target" id="cqe84y_655">JVM compilation target</a>.</p></li><li class="list__item" id="cqe84y_650"><p id="cqe84y_656">Stabilizes a number of functions &ndash; <a href="#timeunit-conversion-between-java-and-kotlin" id="cqe84y_657">TimeUnit conversion between Java and Kotlin</a>, <a href="#cbrt" id="cqe84y_658"><code class="code" id="cqe84y_660">cbrt()</code></a>, <a href="#java-optionals-extension-functions" id="cqe84y_659">Java <code class="code" id="cqe84y_661">Optionals</code> extension functions</a>.</p></li><li class="list__item" id="cqe84y_651"><p id="cqe84y_662">Provides a <a href="#comparable-and-subtractable-timemarks" id="cqe84y_663">preview for comparable and subtractable <code class="code" id="cqe84y_664">TimeMarks</code></a>.</p></li><li class="list__item" id="cqe84y_652"><p id="cqe84y_665">Includes <a href="#recursive-copying-or-deletion-of-directories" id="cqe84y_666">experimental extension functions for <code class="code" id="cqe84y_667">java.nio.file.path</code></a>.</p></li><li class="list__item" id="cqe84y_653"><p id="cqe84y_668">Presents <a href="#improved-kotlin-reflect-performance" id="cqe84y_669">improved kotlin-reflect performance</a>.</p></li></ul><section class="chapter"><h3 id="updated-jvm-compilation-target" data-toc="updated-jvm-compilation-target">Updated JVM compilation target</h3><p id="cqe84y_670">In Kotlin 1.8.0, the standard libraries (<code class="code" id="cqe84y_674">kotlin-stdlib</code>, <code class="code" id="cqe84y_675">kotlin-reflect</code>, and <code class="code" id="cqe84y_676">kotlin-script-*</code>) are compiled with JVM target 1.8. Previously, the standard libraries were compiled with JVM target 1.6.</p><p id="cqe84y_671">Kotlin 1.8.0 no longer supports JVM targets 1.6 and 1.7. As a result, you no longer need to declare <code class="code" id="cqe84y_677">kotlin-stdlib-jdk7</code> and <code class="code" id="cqe84y_678">kotlin-stdlib-jdk8</code> separately in build scripts because the contents of these artifacts have been merged into <code class="code" id="cqe84y_679">kotlin-stdlib</code>.</p><aside class="prompt" data-type="note" data-title="" id="cqe84y_672"><p id="cqe84y_680">If you have explicitly declared <code class="code" id="cqe84y_681">kotlin-stdlib-jdk7</code> and <code class="code" id="cqe84y_682">kotlin-stdlib-jdk8</code> as dependencies in your build scripts, then you should replace them with <code class="code" id="cqe84y_683">kotlin-stdlib</code>.</p></aside><p id="cqe84y_673">Note that mixing different versions of stdlib artifacts could lead to class duplication or to missing classes. To avoid that, the Kotlin Gradle plugin can help you <a href="#usage-of-the-latest-kotlin-stdlib-version-in-transitive-dependencies" id="cqe84y_684">align stdlib versions</a>.</p></section><section class="chapter"><h3 id="cbrt" data-toc="cbrt">cbrt()</h3><p id="cqe84y_685">The <code class="code" id="cqe84y_687">cbrt()</code> function, which allows you to compute the real cube root of a <code class="code" id="cqe84y_688">double</code> or <code class="code" id="cqe84y_689">float</code>, is now Stable.</p><div class="code-block" data-lang="kotlin" data-runnable="true" data-min-compiler-version="1.8">
import kotlin.math.*

fun main() {
    val num = 27
    val negNum = -num

    println(&quot;The cube root of ${num.toDouble()} is: &quot; +
            cbrt(num.toDouble()))
    println(&quot;The cube root of ${negNum.toDouble()} is: &quot; +
            cbrt(negNum.toDouble()))
}
</div></section><section class="chapter"><h3 id="timeunit-conversion-between-java-and-kotlin" data-toc="timeunit-conversion-between-java-and-kotlin">TimeUnit conversion between Java and Kotlin</h3><p id="cqe84y_690">The <code class="code" id="cqe84y_692">toTimeUnit()</code> and <code class="code" id="cqe84y_693">toDurationUnit()</code> functions in <code class="code" id="cqe84y_694">kotlin.time</code> are now Stable. Introduced as Experimental in Kotlin 1.6.0, these functions improve interoperability between Kotlin and Java. You can now easily convert between Java <code class="code" id="cqe84y_695">java.util.concurrent.TimeUnit</code> and Kotlin <code class="code" id="cqe84y_696">kotlin.time.DurationUnit</code>. These functions are supported on the JVM only.</p><div class="code-block" data-lang="kotlin">
import kotlin.time.*

// For use from Java
fun wait(timeout: Long, unit: TimeUnit) {
    val duration: Duration = timeout.toDuration(unit.toDurationUnit())
    ...
}
</div></section><section class="chapter"><h3 id="comparable-and-subtractable-timemarks" data-toc="comparable-and-subtractable-timemarks">Comparable and subtractable TimeMarks</h3><aside class="prompt" data-type="warning" data-title="" id="cqe84y_697"><p id="cqe84y_702">The new functionality of <code class="code" id="cqe84y_703">TimeMarks</code> is <a href="components-stability.html#stability-levels-explained" id="cqe84y_704">Experimental</a>, and to use it you need to opt in by using <code class="code" id="cqe84y_705">@OptIn(ExperimentalTime::class)</code> or <code class="code" id="cqe84y_706">@ExperimentalTime</code>.</p></aside><p id="cqe84y_698">Before Kotlin 1.8.0, if you wanted to calculate the time difference between multiple <code class="code" id="cqe84y_707">TimeMarks</code> and <span class="control" id="cqe84y_708">now</span>, you could only call <code class="code" id="cqe84y_709">elapsedNow()</code> on one <code class="code" id="cqe84y_710">TimeMark</code> at a time. This made it difficult to compare the results because the two <code class="code" id="cqe84y_711">elapsedNow()</code> function calls couldn't be executed at exactly the same time.</p><p id="cqe84y_699">To solve this, in Kotlin 1.8.0 you can subtract and compare <code class="code" id="cqe84y_712">TimeMarks</code> from the same time source. Now you can create a new <code class="code" id="cqe84y_713">TimeMark</code> instance to represent <span class="control" id="cqe84y_714">now</span> and subtract other <code class="code" id="cqe84y_715">TimeMarks</code> from it. This way, the results that you collect from these calculations are guaranteed to be relative to each other.</p><div class="code-block" data-lang="kotlin" data-runnable="true" data-min-compiler-version="1.8">
import kotlin.time.*
fun main() {
//sampleStart
    val timeSource = TimeSource.Monotonic
    val mark1 = timeSource.markNow()
    Thread.sleep(500) // Sleep 0.5 seconds
    val mark2 = timeSource.markNow()

    // Before 1.8.0
    repeat(4) { n -&gt;
        val elapsed1 = mark1.elapsedNow()
        val elapsed2 = mark2.elapsedNow()

        // Difference between elapsed1 and elapsed2 can vary depending 
        // on how much time passes between the two elapsedNow() calls
        println(&quot;Measurement 1.${n + 1}: elapsed1=$elapsed1, &quot; +
                &quot;elapsed2=$elapsed2, diff=${elapsed1 - elapsed2}&quot;)
    }
    println()

    // Since 1.8.0
    repeat(4) { n -&gt;
        val mark3 = timeSource.markNow()
        val elapsed1 = mark3 - mark1
        val elapsed2 = mark3 - mark2

        // Now the elapsed times are calculated relative to mark3, 
        // which is a fixed value
        println(&quot;Measurement 2.${n + 1}: elapsed1=$elapsed1, &quot; +
                &quot;elapsed2=$elapsed2, diff=${elapsed1 - elapsed2}&quot;)
    }
    // It's also possible to compare time marks with each other
    // This is true, as mark2 was captured later than mark1
    println(mark2 &gt; mark1)
//sampleEnd
}

</div><p id="cqe84y_701">This new functionality is particularly useful in animation calculations where you want to calculate the difference between, or compare, multiple <code class="code" id="cqe84y_716">TimeMarks</code> representing different frames.</p></section><section class="chapter"><h3 id="recursive-copying-or-deletion-of-directories" data-toc="recursive-copying-or-deletion-of-directories">Recursive copying or deletion of directories</h3><aside class="prompt" data-type="warning" data-title="" id="cqe84y_717"><p id="cqe84y_724">These new functions for <code class="code" id="cqe84y_725">java.nio.file.path</code> are <a href="components-stability.html#stability-levels-explained" id="cqe84y_726">Experimental</a>. To use them, you need to opt in with <code class="code" id="cqe84y_727">@OptIn(kotlin.io.path.ExperimentalPathApi::class)</code> or <code class="code" id="cqe84y_728">@kotlin.io.path.ExperimentalPathApi</code>. Alternatively, you can use the compiler option <code class="code" id="cqe84y_729">-opt-in=kotlin.io.path.ExperimentalPathApi</code>.</p></aside><p id="cqe84y_718">We have introduced two new extension functions for <code class="code" id="cqe84y_730">java.nio.file.Path</code>, <code class="code" id="cqe84y_731">copyToRecursively()</code> and <code class="code" id="cqe84y_732">deleteRecursively()</code>, which allow you to recursively:</p><ul class="list _bullet" id="cqe84y_719"><li class="list__item" id="cqe84y_733"><p id="cqe84y_735">Copy a directory and its contents to another destination.</p></li><li class="list__item" id="cqe84y_734"><p id="cqe84y_736">Delete a directory and its contents.</p></li></ul><p id="cqe84y_720">These functions can be very useful as part of a backup process.</p><section class="chapter"><h4 id="error-handling" data-toc="error-handling">Error handling</h4><p id="cqe84y_737">Using <code class="code" id="cqe84y_740">copyToRecursively()</code>, you can define what should happen if an exception occurs while copying, by overloading the <code class="code" id="cqe84y_741">onError</code> lambda function:</p><div class="code-block" data-lang="kotlin">
sourceRoot.copyToRecursively(destinationRoot, followLinks = false,
    onError = { source, target, exception -&gt;
        logger.logError(exception, &quot;Failed to copy $source to $target&quot;)
        OnErrorResult.TERMINATE
    })
</div><p id="cqe84y_739">When you use <code class="code" id="cqe84y_742">deleteRecursively()</code>, if an exception occurs while deleting a file or folder, then the file or folder is skipped. Once the deletion has completed, <code class="code" id="cqe84y_743">deleteRecursively()</code> throws an <code class="code" id="cqe84y_744">IOException</code> containing all the exceptions that occurred as suppressed exceptions.</p></section><section class="chapter"><h4 id="file-overwrite" data-toc="file-overwrite">File overwrite</h4><p id="cqe84y_745">If <code class="code" id="cqe84y_747">copyToRecursively()</code> finds that a file already exists in the destination directory, then an exception occurs. If you want to overwrite the file instead, use the overload that has <code class="code" id="cqe84y_748">overwrite</code> as an argument and set it to <code class="code" id="cqe84y_749">true</code>:</p><div class="code-block" data-lang="kotlin">
fun setUpEnvironment(projectDirectory: Path, fixtureName: String) {
    fixturesRoot.resolve(COMMON_FIXTURE_NAME)
        .copyToRecursively(projectDirectory, followLinks = false)
    fixturesRoot.resolve(fixtureName)
        .copyToRecursively(projectDirectory, followLinks = false,
            overwrite = true) // patches the common fixture
}
</div></section><section class="chapter"><h4 id="custom-copying-action" data-toc="custom-copying-action">Custom copying action</h4><p id="cqe84y_750">To define your own custom logic for copying, use the overload that has <code class="code" id="cqe84y_753">copyAction</code> as an additional argument. By using <code class="code" id="cqe84y_754">copyAction</code> you can provide a lambda function, for example, with your preferred actions:</p><div class="code-block" data-lang="kotlin">
sourceRoot.copyToRecursively(destinationRoot, followLinks = false) { source, target -&gt;
    if (source.name.startsWith(&quot;.&quot;)) {
        CopyActionResult.SKIP_SUBTREE
    } else {
        source.copyToIgnoringExistingDirectory(target, followLinks = false)
        CopyActionResult.CONTINUE
    }
}
</div><p id="cqe84y_752">For more information on these extension functions, see <a href="https://kotlinlang.org/api/latest/jvm/stdlib/kotlin.io.path/java.nio.file.-path/copy-to-recursively.html" id="cqe84y_755" data-external="true" rel="noopener noreferrer" target="_blank">our API reference</a>.</p></section></section><section class="chapter"><h3 id="java-optionals-extension-functions" data-toc="java-optionals-extension-functions">Java Optionals extension functions</h3><p id="cqe84y_756">The extension functions that were introduced in <a href="whatsnew17.html#new-experimental-extension-functions-for-java-optionals" id="cqe84y_757">Kotlin 1.7.0</a> are now Stable. These functions simplify working with Optional classes in Java. They can be used to unwrap and convert <code class="code" id="cqe84y_758">Optional</code> objects on the JVM, and to make working with Java APIs more concise. For more information, see <a href="whatsnew17.html#new-experimental-extension-functions-for-java-optionals" id="cqe84y_759">What's new in Kotlin 1.7.0</a>.</p></section><section class="chapter"><h3 id="improved-kotlin-reflect-performance" data-toc="improved-kotlin-reflect-performance">Improved kotlin-reflect performance</h3><p id="cqe84y_760">Taking advantage of the fact that <code class="code" id="cqe84y_761">kotlin-reflect</code> is now compiled with JVM target 1.8, we migrated our internal cache mechanism to Java's <code class="code" id="cqe84y_762">ClassValue</code>. Previously we only cached <code class="code" id="cqe84y_763">KClass</code>, but we now also cache <code class="code" id="cqe84y_764">KType</code> and <code class="code" id="cqe84y_765">KDeclarationContainer</code>. These changes have led to significant performance improvements when invoking <code class="code" id="cqe84y_766">typeOf()</code>.</p></section></section><section class="chapter"><h2 id="documentation-updates" data-toc="documentation-updates">Documentation updates</h2><p id="cqe84y_767">The Kotlin documentation has received some notable changes:</p><section class="chapter"><h3 id="revamped-and-new-pages" data-toc="revamped-and-new-pages">Revamped and new pages</h3><ul class="list _bullet" id="cqe84y_770"><li class="list__item" id="cqe84y_771"><p id="cqe84y_774"><a href="gradle.html" id="cqe84y_775">Gradle overview</a> &ndash; learn how to configure and build a Kotlin project with the Gradle build system, available compiler options, compilation, and caches in the Kotlin Gradle plugin.</p></li><li class="list__item" id="cqe84y_772"><p id="cqe84y_776"><a href="java-to-kotlin-nullability-guide.html" id="cqe84y_777">Nullability in Java and Kotlin</a> &ndash; see the differences between Java's and Kotlin's approaches to handling possibly nullable variables.</p></li><li class="list__item" id="cqe84y_773"><p id="cqe84y_778"><span id="cqe84y_779">Lincheck guide</span> &ndash; learn how to set up and use the Lincheck framework for testing concurrent algorithms on the JVM.</p></li></ul></section><section class="chapter"><h3 id="new-and-updated-tutorials" data-toc="new-and-updated-tutorials">New and updated tutorials</h3><ul class="list _bullet" id="cqe84y_780"><li class="list__item" id="cqe84y_781"><p id="cqe84y_784"><a href="get-started-with-jvm-gradle-project.html" id="cqe84y_785">Get started with Gradle and Kotlin/JVM</a> &ndash; create a console application using IntelliJ IDEA and Gradle.</p></li><li class="list__item" id="cqe84y_782"><p id="cqe84y_786"><a href="https://www.jetbrains.com/help/kotlin-multiplatform-dev/multiplatform-ktor-sqldelight.html" id="cqe84y_787" data-external="true" rel="noopener noreferrer" target="_blank">Create a multiplatform app using Ktor and SQLDelight</a> &ndash; create a mobile application for iOS and Android using Kotlin Multiplatform Mobile.</p></li><li class="list__item" id="cqe84y_783"><p id="cqe84y_788"><a href="https://www.jetbrains.com/help/kotlin-multiplatform-dev/multiplatform-create-first-app.html" id="cqe84y_789" data-external="true" rel="noopener noreferrer" target="_blank">Get started with Kotlin Multiplatform</a> &ndash; learn about cross-platform mobile development with Kotlin and create an app that works on both Android and iOS.</p></li></ul></section></section><section class="chapter"><h2 id="install-kotlin-1-8-0" data-toc="install-kotlin-1-8-0">Install Kotlin 1.8.0</h2><p id="cqe84y_790"><a href="https://www.jetbrains.com/idea/download/" id="cqe84y_793" data-external="true" rel="noopener noreferrer" target="_blank">IntelliJ IDEA</a> 2021.3, 2022.1, and 2022.2 automatically suggest updating the Kotlin plugin to version 1.8.0. IntelliJ IDEA 2022.3 will have the 1.8.0 version of the Kotlin plugin bundled in an upcoming minor update.</p><aside class="prompt" data-type="note" data-title="" id="cqe84y_791"><p id="cqe84y_794">To migrate existing projects to Kotlin 1.8.0 in IntelliJ IDEA 2022.3, change the Kotlin version to <code class="code" id="cqe84y_795">1.8.0</code> and reimport your Gradle or Maven project.</p></aside><p id="cqe84y_792">For Android Studio Electric Eel (221) and Flamingo (222), version 1.8.0 of the Kotlin plugin will be delivered with the upcoming Android Studios updates. The new command-line compiler is available for download on the <a href="https://github.com/JetBrains/kotlin/releases/tag/v1.8.0" id="cqe84y_796" data-external="true" rel="noopener noreferrer" target="_blank">GitHub release page</a>.</p></section><section class="chapter"><h2 id="compatibility-guide-for-kotlin-1-8-0" data-toc="compatibility-guide-for-kotlin-1-8-0">Compatibility guide for Kotlin 1.8.0</h2><p id="cqe84y_797">Kotlin 1.8.0 is a <a href="kotlin-evolution-principles.html#language-and-tooling-releases" id="cqe84y_798">feature release</a> and can, therefore, bring changes that are incompatible with your code written for earlier versions of the language. Find the detailed list of these changes in the <a href="compatibility-guide-18.html" id="cqe84y_799">Compatibility guide for Kotlin 1.8.0</a>.</p></section><div class="last-modified">24 June 2025</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom"><a href="whatsnew1820.html" class="navigation-links__prev">What's new in Kotlin 1.8.20</a><a href="whatsnew1720.html" class="navigation-links__next">What's new in Kotlin 1.7.20</a></div></article><div id="disqus_thread"></div></div></section></main></div><script src="https://resources.jetbrains.com/writerside/apidoc/6.22.0-b776/app.js"></script></body></html>